<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="e2a77267-631a-489c-b34b-559c5a955bb3" activeEnvironment="Default" name="smartNote" resourceRoot="" soapui-version="5.9.1" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="ac1a076a-c45a-4d44-94ac-7fcad6afc092" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://localhost:8000" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://localhost:8000</con:endpoint></con:endpoints><con:resource name="Token" path="/api/token/" id="f60b27b3-12fb-45e0-b45c-8366ef9e19ec"><con:settings/><con:parameters/><con:method name="Token 1" id="23c9e88c-aa95-4f38-8ff4-37b84373c99e" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>405 400 401</con:status><con:params/></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:request name="Request 1" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="user_create" path="/api/users/" id="0877eeb7-b30d-4124-a787-6aafcb1e332b"><con:settings/><con:parameters/><con:method name="Method 1" id="7d4d7abf-2d37-4f66-973f-7c052805527f" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>400 401</con:status><con:params/><con:element xmlns:user="http://localhost/api/users/">user:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>201</con:status><con:params/><con:element xmlns:user="http://localhost/api/users/">user:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:request></con:method></con:resource><con:resource name="me" path="/api/user/me/" id="650b7134-fe7a-4ff5-b20b-2757a3d96b6f"><con:settings/><con:parameters/><con:method name="Method 1" id="246d23b0-d81d-4dcc-9afd-ee9554b23275" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:request name="Request 1" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method><con:method name="Method 2" id="a871f042-16eb-41ba-bb2e-7a4fae2d717b" method="PUT"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401 400</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Response</con:element></con:representation><con:request name="Request 1" id="cfccf2e1-70ff-4b4f-921b-280a4fc0e58e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username": "2hoanglinh1111",
  "email": "user1616111@example.com",
  "fullname": "2hllll",
  "password": "2hoanglinh",
  "firebase_id": "686868686666"
}</con:request><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method><con:method name="Method 3" id="88495544-4e6d-4130-9039-0a2da95177b0" method="DELETE"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:me="http://localhost/api/user/me/">me:Response</con:element></con:representation><con:request name="Request 1" id="bbbd79b3-317c-4b7a-8508-27ea3b26016f" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value=""/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="topics" path="/api/topics/" id="8e4b9198-c1c8-44cb-9b1e-fb9f39f8432f"><con:settings/><con:parameters/><con:method name="Method 1" id="577a89e9-e1cc-4b42-bbfd-b64ebb6d38c1" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401 400</con:status><con:params/><con:element xmlns:top="http://localhost/api/topics/">top:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>201</con:status><con:params/><con:element xmlns:top="http://localhost/api/topics/">top:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv 18/10 v5",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method><con:method name="Method 2" id="5ab58717-2c2c-4a82-a1ea-000051958f33" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401</con:status><con:params/><con:element xmlns:top="http://localhost/api/topics/">top:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:top="http://localhost/api/topics/">top:Response</con:element></con:representation><con:request name="Request 1" id="4653593c-c751-4e0f-91f2-a98eb99a7b18" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="search" path="/api/topics/search/" id="8a8ec109-18c3-4bb6-9c8b-48db2c901e53"><con:settings/><con:parameters><con:parameter><con:name>q</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" id="8a822d73-7d69-4527-a927-8227b9e6f15e" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401</con:status><con:params/><con:element xmlns:sear="http://localhost/api/topics/search/">sear:Fault</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:sear="http://localhost/api/topics/search/">sear:Response</con:element></con:representation><con:request name="Request 1" id="829f4a89-4e5d-464a-870a-085b5e36baf1" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/search/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#search_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>q</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="topic" path="/api/topic/{topic_id}/" id="65088f4b-f465-42d4-aaa9-c3bce17a77d6"><con:settings/><con:parameters><con:parameter><con:name>topic_id</con:name><con:value>${#Project#topic_id}</con:value><con:style>TEMPLATE</con:style><con:default>${#Project#topic_id}</con:default></con:parameter></con:parameters><con:method name="Method 1" id="e9bc1ea2-4d83-44a1-ac32-8a3d6bb4c251" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>text/html; charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:top="http://localhost/api/topic/">top:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>404 401</con:status><con:params/><con:element xmlns:top="http://localhost/api/topic/">top:Fault</con:element></con:representation><con:request name="Request 1" id="86b783fb-a66f-4c3a-8cd5-81c1b893b166" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="{{add_word}}" path="/api/topic/{topic_id}/add-word/{add_word}/" id="a8dbeb7b-d27b-4460-b9d7-deaa0f82e0fd"><con:settings/><con:parameters><con:parameter><con:name>topic_id</con:name><con:value>${#Project#topic_id}</con:value><con:style>TEMPLATE</con:style><con:default>${#Project#topic_id}</con:default></con:parameter><con:parameter><con:name>add_word</con:name><con:value>${#Project#add_word}</con:value><con:style>TEMPLATE</con:style><con:default>${#Project#add_word}</con:default></con:parameter></con:parameters><con:method name="Method 1" id="1a75e76c-65ac-406a-b350-ede47c1f6fbc" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401 404</con:status><con:params/><con:element xmlns:tata="http://localhost/api/topic/44/add-word/tata/">tata:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:tata="http://localhost/api/topic/44/add-word/tata/">tata:Response</con:element></con:representation><con:representation type="FAULT"><con:mediaType>text/html; charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element>html</con:element></con:representation><con:request name="Request 1" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="topic_id" value="${#Project#topic_id" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="delete word" path="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" id="f4a19b13-a467-42dc-98ca-518caff8642e"><con:settings/><con:parameters><con:parameter><con:name>topic_id</con:name><con:value>${#Project#topic_id}</con:value><con:style>TEMPLATE</con:style><con:default>${#Project#topic_id}</con:default></con:parameter><con:parameter><con:name>vocal_topic_id</con:name><con:value>${#Project#vocal_topic_id}</con:value><con:style>TEMPLATE</con:style><con:default>${#Project#vocal_topic_id}</con:default></con:parameter><con:parameter><con:name>vocal_detail_id</con:name><con:value>#Project#vocal_detail_id</con:value><con:style>TEMPLATE</con:style><con:default>#Project#vocal_detail_id</con:default></con:parameter></con:parameters><con:method name="Method 1" id="7a572560-7e2a-4a1c-a6ce-35c936aaf310" method="DELETE"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>text/html; charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>401 404</con:status><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:request name="Request 1" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#Project#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#Project#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:testSuite id="10a2a491-b0b5-437a-8fc0-c50ef33d3354" name="Auth Testsuite"><con:description>TestSuite generated for REST Service [http://localhost:8000]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="e89225f9-fb5d-4132-b399-c69c08f32706" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="11b1b486-462f-4ba9-b70f-c6665471c1cc"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer Token" id="93e6ef56-15ae-484a-8cfb-85d8782adffe"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>REST Request</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>REST Request</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="JDBC_GetUserByUsername" id="7bd363bb-68a1-4fc7-b27a-ef5f540f72fd"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id,
       username,
       email,
       fullname,
       firebase_id,
       created_at
FROM users_user
WHERE username = '${#Project#username}'
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS_SetExpectedFromDB" id="eaf008f5-2236-4086-8c38-2dc2673c8d94"><con:settings/><con:config><script>import groovy.util.XmlSlurper

def jdbcStep = context.testCase.testSteps["JDBC_GetUserByUsername"]

// LẤY ĐÚNG PROPERTY!
def resultXml = jdbcStep.getPropertyValue("ResponseAsXml")

if (!resultXml) {
    assert false : "JDBC_GetUserByUsername không trả về kết quả nào!"
}

// Parse XML
def rs = new XmlSlurper().parseText(resultXml)

// Lấy row đầu tiên
def row = rs.ResultSet.Row[0]
assert row != null : "Không tìm thấy user trong DB!"

// Lấy từng cột
def id         = row.'USERS_USER.ID'.text()
def username   = row.'USERS_USER.USERNAME'.text()
def email      = row.'USERS_USER.EMAIL'.text()
def fullname   = row.'USERS_USER.FULLNAME'.text()

// Lưu expected vào Project
def project = context.testCase.testSuite.project
project.setPropertyValue("user_id",  id)
project.setPropertyValue("username", username)
project.setPropertyValue("email",    email)
project.setPropertyValue("fullname", fullname)

log.info "[Expected from DB] id=${id}, username=${username}, email=${email}, fullname=${fullname}"
</script></con:config></con:testStep><con:loadTest id="4ed62beb-299d-47bb-830d-151d179dbba5" name="Login_05U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>5</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:assertion type="Step Maximum" name="Step Maximum"><con:configuration><name>Step Maximum</name><min-requests>100</min-requests><max-value>2000</max-value><test-step>- Any -</test-step><max-errors>-1</max-errors></con:configuration></con:assertion><con:assertion type="Step Average" name="Step Average"><con:configuration><name>Step Average</name><min-requests>100</min-requests><max-average>300</max-average><test-step>- Any -</test-step><max-errors>-1</max-errors><sample-interval>20</sample-interval></con:configuration></con:assertion><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="042c086b-dc86-42bf-984b-15742b4f3ad9" name="Login_10U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>10</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="3a688b0b-28b1-4aa4-8f6c-ebb1e6992479" name="Login_20U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>20</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="c9ef21a5-a5c0-4be0-bc3f-5d956585e9cc" name="Login_40U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>40</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>1000</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="aa14fa87-6dd9-4efd-b04b-561f8ab796a0" name="Login_60U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>60</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="c5981d29-5042-4ba8-87bf-fe2356aa468c" name="Login_80U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="3fb19a98-bb97-4553-b137-de19989b1d1b" name="Login_100U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="e769bdbe-73ce-4ab0-9a9b-263a686ee87c" name="Login_Spike_100U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>10000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="00ff81b4-57f5-4a54-a524-33acf59d0c2e" name="Login_Spike_200U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>10000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="4fea7786-aba1-408c-8d01-9ebb9389d192" name="Login_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>600</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>2500</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="fa6b6f89-7868-4636-a20d-7461f189e1ea" name="Login_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.5</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:testCase id="c4f6f056-dbff-43b4-95fc-ae7a77ee2ce0" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_Wrong Username/password" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="c1dcdfaf-ca9a-4026-9b87-8f4b3192389d"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "h", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="0e1fc331-9480-4498-ae4a-33c7004fda0e" name="Valid HTTP Status Codes"><con:configuration><codes>401</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5f77ceff-d60b-41fe-8762-b7777616a315" name="JsonPath Match"><con:configuration><path>$.success</path><content>false</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Simple Contains" id="5a8425b1-7920-40d6-9c62-90296a7da352" name="Contains"><con:configuration><token>No active account found with the given credentials</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3553b815-bf08-4e7c-9942-91458d4d5fca"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="49d639b0-9d0f-45c1-9fd7-34f9d5ad8640" name="JsonPath Match 1"><con:configuration><path>$.data</path><content>{}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="14d81c54-64bb-4648-9cde-6f445bb27abd" name="Not Contains"><con:configuration><token>access</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="f78aab50-987f-4af7-a856-2825c46e7eb4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Empty Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="63fe6a68-ddca-43f0-ab96-d00080d32afe"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="56967687-0da5-4d34-a52c-97327c871416" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
def json = new JsonSlurper().parseText(messageExchange.responseContent)

// 1. HTTP status phải là 400
assert messageExchange.responseHeaders["#status#"][0].contains("400")

// 2. Phải có field errors.username
assert json.errors
assert json.errors.username

// 3. errors.username phải là List
assert json.errors.username instanceof List

// 4. Thông báo lỗi phải liên quan đến "blank" hoặc "required"
def msg = json.errors.username[0].toLowerCase()
assert msg.contains("blank") || msg.contains("required")

// 5. Không được trả access/refresh
assert !json.access
assert !json.refresh
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="bd038c89-ca67-4276-9da0-b06deb2852f3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_Empty Password" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b3408412-62ec-43aa-b4df-6bd428b6a729"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="1ce86624-41c6-4d08-aa45-afb94ed164f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
def json = new JsonSlurper().parseText(messageExchange.responseContent)

assert messageExchange.responseHeaders["#status#"][0].contains("400")

assert json.errors
assert json.errors.password
assert json.errors.password instanceof List

def msg = json.errors.password[0].toLowerCase()
assert msg.contains("blank") || msg.contains("required")

assert !json.access
assert !json.refresh
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="3cd5c9bb-d200-43b3-aaf4-7d9d8c42d5b4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_05_Missing Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="447000c1-2c6c-4c10-85f5-f378810fce6f"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{"password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="49017725-9fb7-4b2d-8791-c09935aec312" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy response
def response = messageExchange.responseContent
assert response : "Response rỗng – API không trả về dữ liệu!"

// Parse JSON
def json = new JsonSlurper().parseText(response)

// --- 1. Kiểm tra HTTP status (tuỳ backend, thường 400 Bad Request) ---
assert messageExchange.responseHeaders["#status#"][0].contains("400") : "HTTP status không phải 400 – Response: ${messageExchange.responseContent}"

// --- 2. Kiểm tra success phải là false ---
assert json.success == false : "Success không phải false"

// --- 3. Kiểm tra có field errors ---
assert json.errors : "Không có field 'errors' trong response"

// --- 4. Kiểm tra username tồn tại trong errors ---
assert json.errors.username : "Field 'username' không tồn tại trong errors"

// --- 5. username phải là List ---
assert json.errors.username instanceof List : "Field 'username' không phải dạng List"

// --- 6. Kiểm tra thông báo lỗi có liên quan đến 'required' hoặc 'blank' ---
def usernameErrorMsg = json.errors.username[0].toLowerCase()
assert usernameErrorMsg.contains("required") || usernameErrorMsg.contains("blank") : "Message lỗi không hợp lệ: ${usernameErrorMsg}"

log.info "Validation error username – Assertion passed!"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="f502f168-40d9-48ee-b679-293c3cc85df4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_06_Missing Password" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="54ec8eaa-3aae-4108-b24a-7d8b0c0e7b22"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}"}</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="fbcccac0-5993-4bb7-956f-97ba86d002d9" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy response
def response = messageExchange.responseContent
assert response : "Response rỗng – API không trả về dữ liệu!"

// Parse JSON
def json = new JsonSlurper().parseText(response)

// --- 1. Kiểm tra HTTP status (tuỳ backend, thường 400 Bad Request) ---
assert messageExchange.responseHeaders["#status#"][0].contains("400") : "HTTP status không phải 400 – Response: ${messageExchange.responseContent}"

// --- 2. Kiểm tra success phải là false ---
assert json.success == false : "Success không phải false"

// --- 3. Kiểm tra có field errors ---
assert json.errors : "Không có field 'errors' trong response"

// --- 4. Kiểm tra username tồn tại trong errors ---
assert json.errors.password : "Field 'password' không tồn tại trong errors"

// --- 5. username phải là List ---
assert json.errors.password instanceof List : "Field 'password' không phải dạng List"

// --- 6. Kiểm tra thông báo lỗi có liên quan đến 'required' hoặc 'blank' ---
def passwordErrorMsg = json.errors.password[0].toLowerCase()
assert passwordErrorMsg.contains("required") || passwordErrorMsg.contains("blank") : "Message lỗi không hợp lệ: ${passwordErrorMsg}"

log.info "Validation error password – Assertion passed!"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="8ee5cb02-bccd-4849-bce0-a21c6155ed7c" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_07_JDBC Request" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="JDBC Request" id="e7d89b78-d732-48f6-a59e-02b8f600a35e"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS CNT
FROM users_user
WHERE username = ''' OR ''1''=''1';</con:query><con:properties/></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="f69a14f3-c8f0-4f80-b1ff-72640d3f3b8a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_08_Sql Injection" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="ac23ca35-9630-40a1-981d-c5ebfba93f5c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "' OR '1'='1", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>// Script Assertion: kiểm tra HTTP status + không lộ lỗi SQL/debug

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer

// Cho phép các mã lỗi khi SQLi (sai TK/MK, request không hợp lệ...)
def allowedCodes = [400, 401]

assert allowedCodes.contains(status) : 
        "HTTP status không hợp lệ cho test SQLi, expected one of ${allowedCodes}, got ${status}"

// ===== 2. Kiểm tra KHÔNG lộ lỗi SQL / debug info =====
def body  = messageExchange.responseContent ?: ""
def lower = body.toLowerCase()

// Các chuỗi NHẠY CẢM không được xuất hiện trong response
def forbidden = [
    "syntax error",
    "sql",
    "mysql",
    "ora-",
    "exception",
    "stack trace"
]

// Tìm xem có chuỗi cấm nào xuất hiện không
def hits = forbidden.findAll { f -> lower.contains(f.toLowerCase()) }

assert hits.isEmpty() : 
        "Response chứa thông tin lỗi/SQL nhạy cảm: ${hits.join(', ')}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="53ab2424-1a59-46e4-9e97-338ff6b2e4fe" name="Create User Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="93af7c69-0eb5-48e6-aabb-31ccf8aadc92" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success_Normal" searchProperties="true"><con:settings/><con:testStep type="groovy" name="GS_GenUserData" id="fc710ef5-376f-4873-bc3e-d0cd57057503"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.security.SecureRandom

def now = new Date()
def fmt = new SimpleDateFormat("yyyyMMdd_HHmmss")
def timeStr = fmt.format(now)

// random suffix ngắn để tránh trùng
def randomSuffix = UUID.randomUUID().toString().replace("-", "").substring(0, 6)

// username: tối đa 150 ký tự, mình làm gọn gàng
def username = "u_${timeStr}_${randomSuffix}"   // ví dụ: u_20251206_231530_ab12cd

// email: dùng luôn username cho dễ trace
def email = "${username}@testmail.com"

// fullname: demo đơn giản, anh thích thì đổi
def fullname = "User ${timeStr}"

// password: random số cho đỡ trùng
def rnd = new SecureRandom()
def password = "Pass" + (100000 + rnd.nextInt(900000))  // Pass123456

// firebase_id: chuỗi 16 số ngẫu nhiên (anh muốn 18–20 số thì tăng length lên)
def firebaseIdLength = 16
def firebaseId = (1..firebaseIdLength).collect { rnd.nextInt(10) }.join()

// ===== Ghi vào Project Properties =====
def project = context.testCase.testSuite.project
project.setPropertyValue("username",    username)
project.setPropertyValue("email",       email)
project.setPropertyValue("fullname",    fullname)
project.setPropertyValue("password",    password)
project.setPropertyValue("firebase_id", firebaseId)

// Log cho dễ debug
log.info "Generated username   = ${username}"
log.info "Generated email      = ${email}"
log.info "Generated fullname   = ${fullname}"
log.info "Generated password   = ${password}"
log.info "Generated firebaseId = ${firebaseId}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="d5053bf5-d20e-404c-a8c7-96cf22b15d28"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username": "${#Project#username}",
  "email": "${#Project#email}",
  "fullname": "${#Project#fullname}",
  "password": "${#Project#password}",
  "firebase_id": "${#Project#firebase_id}"
}</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="81a9852d-65c1-438f-a396-51d57c65f947" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
import java.time.OffsetDateTime

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer
assert status == 201 || status == 200 : "Expected HTTP 201/200 nhưng nhận được ${status}"

// ===== 2. Parse JSON =====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ===== 3. Check các field top-level =====
assert json.success == true : "Trường success phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "message phải = 'Created', hiện tại = '${json.message}'"
assert json.data != null : "Trường data bị null!"

def data = json.data

// ===== 4. Kiểm tra các field trong data =====

// id > 0
assert (data.id instanceof Number) &amp;&amp; data.id > 0 : "id phải là số dương, hiện tại = ${data.id}"

// các field string không được rỗng
assert data.username : "username trống hoặc null!"
assert data.email    : "email trống hoặc null!"
assert data.fullname : "fullname trống hoặc null!"
assert data.firebase_id : "firebase_id trống hoặc null!"
assert data.created_at  : "created_at trống hoặc null!"

// ===== 5. Không được có field password ở root hoặc trong data =====
assert !json.containsKey('password') : "Response root không được chứa field 'password'!"

if (json.data instanceof Map) {
    assert !json.data.containsKey('password') : "Response.data không được chứa field 'password'!"
}

// ===== 6. Validate format thời gian created_at (ISO-8601) =====
try {
    OffsetDateTime.parse(data.created_at as String)
} catch (Exception e) {
    assert false : "created_at không phải định dạng ISO-8601 hợp lệ: ${data.created_at}"
}</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:loadTest id="f2469646-4aba-4951-9a17-a12ff3ac68b8" name="CreateUser_30U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>30</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="202d7d10-dcb6-4064-b71e-59c075476325" name="CreateUser_80U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="3108edd3-5345-4262-81c4-5538bec14fcd" name="CreateUser_150U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="416f8ad5-8014-4ec7-a7a0-c626cf4d6d3e" name="CreateUser_200U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="aa28c300-4cb0-4130-912c-7ab64ce0bc1e" name="CreateUser_50U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>300</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>3000</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>username</con:name><con:value/></con:property><con:property><con:name>email</con:name><con:value/></con:property><con:property><con:name>fullname</con:name><con:value/></con:property><con:property><con:name>password</con:name><con:value/></con:property><con:property><con:name>firebaseId</con:name></con:property></con:properties></con:testCase><con:testCase id="5a807293-6ef9-4f63-bcb2-0410015bbd82" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_Success_UnicodeName" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Copy of TC_02_Success_UnicodeName" id="48cd23ab-6cc0-474a-9368-877ea1100ce2"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Copy of TC_02_Success_UnicodeName" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json; charset=UTF-8" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "huy_dep_traiii",
      "email": "230206657@vnu.edu.vn",
      "fullname": "Đào Quang Huy",
      "password": "huy123####",
      "firebase_id": "88888888888888"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="81a9852d-65c1-438f-a396-51d57c65f947" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
import java.time.OffsetDateTime

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer
assert status == 201 : "Expected HTTP 201nhưng nhận được ${status}"

// ===== 2. Parse JSON =====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ===== 3. Check các field top-level =====
assert json.success == true : "Trường success phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "message phải = 'Created', hiện tại = '${json.message}'"
assert json.data != null : "Trường data bị null!"

def data = json.data

// ===== 4. Kiểm tra các field trong data =====

// id > 0
assert (data.id instanceof Number) &amp;&amp; data.id > 0 : "id phải là số dương, hiện tại = ${data.id}"

// các field string không được rỗng
assert data.username : "username trống hoặc null!"
assert data.email    : "email trống hoặc null!"
assert data.fullname : "fullname trống hoặc null!"
assert data.firebase_id : "firebase_id trống hoặc null!"
assert data.created_at  : "created_at trống hoặc null!"

// ===== 5. Không được có field password ở root hoặc trong data =====
assert !json.containsKey('password') : "Response root không được chứa field 'password'!"

if (json.data instanceof Map) {
    assert !json.data.containsKey('password') : "Response.data không được chứa field 'password'!"
}

// ===== 6. Validate format thời gian created_at (ISO-8601) =====
try {
    OffsetDateTime.parse(data.created_at as String)
} catch (Exception e) {
    assert false : "created_at không phải định dạng ISO-8601 hợp lệ: ${data.created_at}"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="59a5d889-0f4f-4910-a749-8ee1924858e8" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy raw response
def raw = messageExchange.responseContent
assert raw : "Response rỗng, không có gì để gán biến!"

// Parse JSON
def json = new JsonSlurper().parseText(raw)

// Đảm bảo tạo thành công
assert json.success == true : "Create user thất bại, không gán biến đâu!"
assert json.data != null : "Trường data null, không gán biến được!"

def data = json.data

// 1) Gán vào TestCase Properties (dùng trong cùng TestCase)
def tc = context.testCase
tc.setPropertyValue("user_id",      (data.id ?: "").toString())
tc.setPropertyValue("username",     (data.username ?: "").toString())
tc.setPropertyValue("email",        (data.email ?: "").toString())
tc.setPropertyValue("fullname",     (data.fullname ?: "").toString())
tc.setPropertyValue("firebase_id",  (data.firebase_id ?: "").toString())
tc.setPropertyValue("created_at",   (data.created_at ?: "").toString())

// 2) (Tùy chọn) Gán thêm vào Project Properties để các TestCase khác dùng chung
def project = tc.testSuite.project
project.setPropertyValue("current_user_id",     (data.id ?: "").toString())
project.setPropertyValue("current_username",    (data.username ?: "").toString())
project.setPropertyValue("current_email",       (data.email ?: "").toString())
project.setPropertyValue("current_fullname",    (data.fullname ?: "").toString())
project.setPropertyValue("current_firebase_id", (data.firebase_id ?: "").toString())
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="46d1cf0d-8a28-4cfe-b141-2801897a839d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Missing Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Copy of TC_03_Missing Username" id="1d35a9e1-1a0d-453a-98c9-5093c4e97591"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Copy of TC_03_Missing Username" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "email": "hoang25004666@gmail.com",
      "fullname": "dao huy hoangggg",
      "password": "hoang123",
      "firebase_id": "6666666666666zz"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2ad4dc67-579c-4f65-a0ff-d1671c6c47ca" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 :
        "Expected HTTP 400 cho case thiếu username, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case thiếu username thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "This field is required." :
        "Thông báo lỗi username sai. Expected 'This field is required.', got '${firstMsg}'"


</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e535b279-32a4-4cff-9c53-860b730cfac8" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_Empty Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="ef87b7ab-3433-47fb-b9ba-14ec9debb06d"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "",
      "email": "hoang2500468@gmail.com",
      "fullname": "dao huy hoangzz",
      "password": "hoang123",
      "firebase_id": "6666666666666xx"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7b01f11f-4399-4178-ae3b-932ab9c0a13b" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case username rỗng, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case username rỗng thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "This field may not be blank." :
        "Thông báo lỗi username sai. Expected 'This field may not be blank.', got '${firstMsg}'"


</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="df001e1d-e04f-4230-89f0-36468eec991d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_05_Invalid Char Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="6516ed9d-83f8-4f5e-bde0-018e227ca7a5"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "đào_hoàng",
      "email": "hoang2500461@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "1901010"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="f614f52d-44ec-4d5f-9b8b-d2f4c96809ea" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case username sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case username sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "Username ≥4 ký tự, chỉ gồm chữ/số/_."
        : "Thông báo lỗi username sai. Expected 'Username ≥4 ký tự, chỉ gồm chữ/số/_.', got '${firstMsg}'"

// ==== 5. Không lộ password trong response (phòng hờ) ====
assert !json.containsKey('password') : "Root response không được có field 'password'"
if (json.data instanceof Map) {
    assert !json.data.containsKey('password') :
            "data không được có field 'password'"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="78f96667-dfcc-47db-8879-0aa440a7582b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_06_Invalid Email Format" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="702c9e39-1fdb-4cc5-9927-063f5ae3270d"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "hoang_dep_traizzz",
      "email": "23020666",
      "fullname": "Đào Huy Hoàng",
      "password": "hoang123####",
      "firebase_id": "666666666666666sssiizz"
}</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7fbf16bb-7db4-4d99-8db8-ff5231d19e2f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case email sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case email sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field email ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List &amp;&amp; json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def firstMsg = json.errors.email[0] as String
assert firstMsg == "Enter a valid email address." :
        "Thông báo lỗi email sai. Expected 'Enter a valid email address.', got '${firstMsg}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e4b3cc54-9957-4988-baef-26731c5d8553" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_07_Name Already Exists" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="d5ce04d9-9ba0-4d1e-9fd2-eb6079b79d6c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5f5366ba-34f9-48fa-8aa0-55053b65ed98" name="Script Assertion"><con:configuration><scriptText><![CDATA[import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case trùng thông tin, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case trùng thông tin thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map && json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho từng field ====

// ----- username -----
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List && json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def usernameMsg = json.errors.username[0] as String
assert usernameMsg == "This field must be unique." :
        "Thông báo lỗi username sai. Expected 'This field must be unique.', got '${usernameMsg}'"

// ----- email -----
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List && json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def emailMsg = json.errors.email[0] as String
assert emailMsg == "This field must be unique." :
        "Thông báo lỗi email sai. Expected 'This field must be unique.', got '${emailMsg}'"

// ----- firebase_id -----
assert json.errors.firebase_id != null :
        "errors phải có key 'firebase_id'"
assert json.errors.firebase_id instanceof List && json.errors.firebase_id.size() > 0 :
        "errors.firebase_id phải là list chứa ít nhất 1 message, hiện = ${json.errors.firebase_id}"

def firebaseMsg = json.errors.firebase_id[0] as String
assert firebaseMsg == "user with this firebase id already exists." :
        "Thông báo lỗi firebase_id sai. Expected 'user with this firebase id already exists.', got '${firebaseMsg}'"

]]></scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e9e266d4-b79d-4142-9327-403e8df8c3e5" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_08_DBVerify_User Created Correctly" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="REST Request" id="5e688fff-2c9a-4fde-baba-a2c4de57b65e"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT username, email, fullname, firebase_id
FROM users_user
WHERE username = '${#TestCase#username}';
</con:query><con:assertion type="GroovyScriptAssertion" id="07b84d2a-7202-454c-8d5a-fbe8f358cf20" name="Script Assertion"><con:configuration><scriptText>// JDBC assertion: kiểm tra user vừa tạo có đúng trong DB

def xmlText = messageExchange.responseContent
assert xmlText : "JDBC response rỗng – kiểm tra lại query!"

def xml = new XmlSlurper().parseText(xmlText)

// Lấy tất cả Row
def rows = xml.ResultSet.Row
def expectedUsername = context.expand('${#TestCase#username}')
def expectedEmail    = context.expand('${#TestCase#email}')
def expectedFullname = context.expand('${#TestCase#fullname}')
def expectedFirebase = context.expand('${#TestCase#firebase_id}')

// 1. Phải có đúng 1 bản ghi
assert rows.size() == 1 : "Expected 1 user with username=${expectedUsername}, nhưng tìm thấy ${rows.size()} bản ghi."

def row = rows[0]

def dbUsername = row.'USERS_USER.USERNAME'.text()
def dbEmail    = row.'USERS_USER.EMAIL'.text()
def dbFullname = row.'USERS_USER.FULLNAME'.text()
def dbFirebase = row.'USERS_USER.FIREBASE_ID'.text()

// 2. So sánh từng field
assert dbUsername == expectedUsername : "USERNAME trong DB (${dbUsername}) khác expected (${expectedUsername})"
assert dbEmail    == expectedEmail    : "EMAIL trong DB (${dbEmail}) khác expected (${expectedEmail})"
assert dbFullname == expectedFullname : "FULLNAME trong DB (${dbFullname}) khác expected (${expectedFullname})"
assert dbFirebase == expectedFirebase : "FIREBASE_ID trong DB (${dbFirebase}) khác expected (${expectedFirebase})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="7ce24ddd-ed22-4224-95d3-d3c8d373c34a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_09_Username Too Long" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="cdc4b35f-711b-4258-949e-f1ff06315ed0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
      "email": "hoang250046uu@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666iioo"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="99e349da-f8ee-4353-b797-53d2ff710f9a" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// --- 0. Kiểm tra có response không ---
assert messageExchange.response, " Không có response trả về"

// --- 1. Kiểm tra HTTP status code ---
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : " Status code phải là 400 cho case username quá dài, hiện tại = ${status}"

// --- 2. Parse JSON body ---
def body = messageExchange.responseContent
assert body, " Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (Exception e) {
    assert false : " Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// --- 3. Kiểm tra field 'success' ---
assert json.success == false : " 'success' phải = false cho case username too long, hiện tại = ${json.success}"

// --- 4. Kiểm tra 'message' ---
assert json.message == "Validation error" : " 'message' phải = 'Validation error', hiện tại = '${json.message}'"

// --- 5. Kiểm tra 'data' là object rỗng ---
assert json.data instanceof Map : " 'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : " 'data' phải rỗng {}, hiện tại = ${json.data}"

// --- 6. Kiểm tra errors.username tồn tại ---
assert json.errors : " Không có field 'errors' trong response"
assert json.errors.username : " Không có lỗi cho field 'username' trong errors"
assert json.errors.username[0] : " errors.username[0] rỗng"

// --- 7. Kiểm tra nội dung thông báo lỗi username ---
def errMsg = (json.errors.username[0] as String).toLowerCase()
def expectedPart = "no more than 150"
assert errMsg.contains(expectedPart) : " Message lỗi username không đúng.\nThực tế: '${errMsg}'\nMong đợi chứa: '${expectedPart}'"

// --- 8. Log cho dễ nhìn trong TestCase Log ---
log.info "✅ Username too long: status=${status}, success=${json.success}, msg='${json.message}', usernameError='${json.errors.username[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="50cc0b55-19a6-4c10-bc5b-cf9ebc72fe0b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_10_Email Already Exists" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="f12e47b7-8bbc-4e23-9e5c-6a4aa1302dea"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang0aaoke",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666vvv"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="bce04400-ffdd-49ee-b54c-33b268518b49" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// --- 0. Kiểm tra có response không ---
assert messageExchange.response, " Không có response trả về"

// --- 1. Kiểm tra HTTP status code ---
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : " Status code phải là 400 cho case email trùng, hiện tại = ${status}"

// --- 2. Parse JSON body ---
def body = messageExchange.responseContent
assert body, " Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (Exception e) {
    assert false : " Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// --- 3. Kiểm tra field 'success' ---
assert json.success == false : " 'success' phải = false cho case duplicate email, hiện tại = ${json.success}"

// --- 4. Kiểm tra 'message' ---
assert json.message == "Validation error" : " 'message' phải = 'Validation error', hiện tại = '${json.message}'"

// --- 5. Kiểm tra 'data' là object rỗng ---
assert json.data instanceof Map : " 'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : " 'data' phải rỗng {}, hiện tại = ${json.data}"

// --- 6. Kiểm tra errors.email tồn tại ---
assert json.errors : " Không có field 'errors' trong response"
assert json.errors.email : " Không có lỗi cho field 'email' trong errors"
assert json.errors.email[0] : " errors.email[0] rỗng"

// --- 7. Kiểm tra nội dung thông báo lỗi email ---
def errMsg = (json.errors.email[0] as String).toLowerCase()
def expectedPart = "must be unique"
assert errMsg.contains(expectedPart) : " Message lỗi email không đúng.\nThực tế: '${errMsg}'\nMong đợi chứa: '${expectedPart}'"

// --- 8. Log cho dễ debug ---
log.info "✅ Duplicate email: status=${status}, success=${json.success}, msg='${json.message}', emailError='${json.errors.email[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="6ccebb34-8ec4-4487-8b80-572ed51d59ac" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_11_SQL Injection or Special Characters" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="31e8ab2c-4b59-40cf-973f-1fdefc1d1b43"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "abcd'); DROP TABLE users; --",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ab94836c-78c2-4cff-a1a1-2b1cf0285e5d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra HTTP status code (thường là 400 hoặc 422)
def status = messageExchange.responseHeaders["#status#"][0]
assert status.contains("400") || status.contains("422") :
       "Expected HTTP 400/422 but got: ${status}"

// 2. Parse JSON response
def json = new JsonSlurper().parseText(messageExchange.responseContent)

// 3. success phải bằng false
assert json.success == false :
       "Expected success=false but got ${json.success}"

// 4. message phải đúng
assert json.message == "Validation error" :
       "Expected 'Validation error' but got '${json.message}'"

// 5. Trường lỗi username phải có
assert json.errors?.username != null :
       "errors.username is missing in response"

// 6. Nội dung lỗi phải đúng
// Với testcase ký tự đặc biệt hoặc SQL injection, backend của bạn trả về cùng message:
def expectedError = "Username ≥4 ký tự, chỉ gồm chữ/số/_." 
def actualError = json.errors.username[0]

assert actualError == expectedError :
       "Expected error='${expectedError}' but got='${actualError}'"

// 7. Log PASS
log.info "✔ SQL Injection/Special Characters test PASSED – API đã chặn username độc hại."
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="76fa36c9-9897-4e59-8863-4da7c1125489" name="Get User Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="26ee3bf6-f842-4db9-ae83-c5adf9013234" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="d34c7aa3-d707-408d-a531-ed8fe67ea480"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ Project (do JDBC step set trước đó)
def expectedUsername = context.expand('${#Project#username}')
def expectedEmail    = context.expand('${#Project#email}')
def expectedFullname = context.expand('${#Project#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email == expectedEmail       : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:loadTest id="0e7d515c-4025-45c7-b025-9ab80f883057" name="GetUser_10U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>10</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="f7641fd3-522b-4163-95ab-5252c80857b6" name="GetUser_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="1feb32c9-453d-4548-8fcc-721dde187f99" name="GetUser_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="1e3b6e45-47ed-49f8-b908-32d97930d6a0" name="GetUser_150U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="b0a7659e-5379-4e0f-a00e-a343bd35a5dc" name="GetUser_150U_Spike"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>15000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="1f767e2f-c735-46f1-bb96-be208284d50d" name="GetUser_200U_Spike"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>15000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="59475683-3d58-41e1-8a94-fbf94c18bafb" name="GetUser_100U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.5</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="58e39c2e-d755-4a0e-900e-1745fff8648b" name="GetUser_250U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>250</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.5</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="3dc9cdbc-4c9b-4745-b5b4-059c44d8cfba" name="GetUser_100U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>1800</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:setupScript/><con:properties/></con:testCase><con:testCase id="ad7a005a-01d3-4d43-939a-fbe9dd5c6585" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_No Token_Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="ef785115-1b94-43a1-bd1d-be956c204c81"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="8afe295c-39a1-496f-8a75-d38d29456e81" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status phải là 401
def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Expected 401 but got ${status}"

// 2. Parse JSON body
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Check các field
assert json.success == false : "success phải = false"
assert json.message == "Authentication credentials were not provided." :
        "Sai message, got: '${json.message}'"

assert json.data instanceof Map : "data phải là object {}"
assert json.data.isEmpty()      : "data phải rỗng {}"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="2afb8de6-148d-4c55-b792-3c965671d9d1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Invalid Token_Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="cbc609df-c0e8-4abd-9a0e-c02c2de5a7b4"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123456"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="b68399ad-4ce3-4009-ac62-9fd6077f5e99" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Expected 401 but got ${status}"

def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

assert json.success == false : "success phải = false"

// chỉ cần message chứa cụm 'token not valid' là ok
def msg = (json.message ?: "").toLowerCase()
assert msg.contains("token not valid") :
        "Sai message, expected contain 'token not valid', got: '${json.message}'"

assert json.data instanceof Map : "data phải là object {}"
assert json.data.isEmpty()      : "data phải rỗng {}"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="4b448ac2-20bb-45ce-86bb-2b3c2f6f30d1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_NoSensitiveFields In Response" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="25760d33-24dd-4440-aa6d-a7c9b8a827cc"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ead52b62-a855-41da-93e3-61fbe77b8310" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

def status = messageExchange.responseStatusCode as Integer
assert status == 200

def forbiddenFields = [
    "password",
    "is_superuser",
    "last_login",
    "groups",
    "permissions",
    "user_flags"
]

// Lấy danh sách key trong json.data
def dataKeys = json.data?.keySet()*.toString() ?: []

for (f in forbiddenFields) {
    assert !dataKeys.contains(f) :
        "json.data không được chứa field nhạy cảm '${f}', nhưng hiện đang có! Keys: ${dataKeys}"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:setupScript>def project = context.testCase.testSuite.project

def authSuite = project.testSuites["Auth Testsuite"]
if (!authSuite) {
    log.error "Không tìm thấy TestSuite 'Auth Testsuite'"
    return
}

def tcPostToken = authSuite.testCases["TC_01_success"]
if (!tcPostToken) {
    log.error "Không tìm thấy TestCase 'TC_01_Success'"
    return
}

log.info ">>> [Setup] Chạy TC_01_success (Auth) để lấy token trước khi GET /user/me"

def ctxMap = new com.eviware.soapui.support.types.StringToObjectMap()
def result = tcPostToken.run(ctxMap, false)

log.info "Kết quả chạy auth: " + result.status
</con:setupScript><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="059d6340-6b5a-4d86-b553-a0691e336171" name="Put User Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="b0c030d0-0ba5-4269-8ec7-3a5c9d9924b7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="groovy" name="GS_GenUpdateMeData" id="8bf3d375-f8af-4b7f-98fd-5050ba8c91f3"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.security.SecureRandom

// Lấy username/password hiện tại từ Project (do Sign up / Login set)
def p  = context.testCase.testSuite.project
def username = p.getPropertyValue("username")
def oldPass  = p.getPropertyValue("password")

assert username : "Project#username đang rỗng – phải chạy Sign up/Login trước!"
assert oldPass  : "Project#password đang rỗng – phải chạy Sign up/Login trước!"

// Sinh dữ liệu mới
def timeStr = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date())
def randomSuffix = UUID.randomUUID().toString().substring(0, 6)

def newEmail    = "user_${timeStr}_${randomSuffix}@example.com"
def newFullname = "User_${timeStr}"
def newFirebase = "fb_${timeStr}"

// 🔐 Sinh mật khẩu mới
def rnd = new SecureRandom()
def newPass = "Pass" + (100000 + rnd.nextInt(900000))  // VD: Pass123456

// Ghi vào TestCase
def tc = context.testCase
tc.setPropertyValue("upd_username",    username)  // username giữ nguyên
tc.setPropertyValue("upd_old_password", oldPass)  // để debug nếu cần
tc.setPropertyValue("upd_new_password", newPass)
tc.setPropertyValue("upd_email",       newEmail)
tc.setPropertyValue("upd_fullname",    newFullname)
tc.setPropertyValue("upd_firebase",    newFirebase)

log.info "UpdateMe username        = ${username}"
log.info "UpdateMe old_password    = ${oldPass}"
log.info "UpdateMe NEW password    = ${newPass}"
log.info "UpdateMe new_email       = ${newEmail}"
log.info "UpdateMe new_fullname    = ${newFullname}"
log.info "UpdateMe new_firebase    = ${newFirebase}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="a0323144-52cc-4116-a4bb-796b6fedcbc0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="cfccf2e1-70ff-4b4f-921b-280a4fc0e58e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username":   "${#TestCase#upd_username}",
  "email":      "${#TestCase#upd_email}",
  "fullname":   "${#TestCase#upd_fullname}",
  "password":   "${#TestCase#upd_new_password}",
  "firebase_id": "${#TestCase#upd_firebase}"
}
</con:request><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="e88ff26e-24c2-4304-b8e7-ce7e95ab3aa9" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected HTTP 200 but got ${status}"

// 2. Lấy response body
def rawBody = messageExchange.response.contentAsString
assert rawBody : "Response body is empty"

// 3. Parse JSON
def json
try {
    json = new JsonSlurper().parseText(rawBody)
} catch (Exception e) {
    assert false : "Response is not valid JSON: ${e.message}\nBody: ${rawBody}"
}

// 4. Kiểm tra các field top-level
assert json.success == true : "success must be true but was: ${json.success}"
assert json.message?.toString().contains("Updated") : "message must contain 'Updated' but was: ${json.message}"

// 5. Kiểm tra data không null
assert json.data != null : "data must not be null"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GS_UpdateVariable" id="7ec9ccfe-ab00-4126-895c-4d565e4e8dca"><con:settings/><con:config><script>import groovy.json.JsonSlurper

// Lấy step request (Step 1)
def restStep = context.testCase.testSteps["REST Request"]

if (!restStep) {
    log.error "Không tìm thấy step 'REST Request'"
    return
}

// Lấy response
def resp = restStep.testRequest.response
if (!resp) {
    log.error "Chưa có response từ step 'REST Request'"
    return
}

// Parse JSON response
def rawBody = resp.contentAsString
if (!rawBody) {
    log.error "Response body rỗng"
    return
}

def json
try {
    json = new JsonSlurper().parseText(rawBody)
} catch (e) {
    log.error "Không parse được JSON từ response: ${e.message}"
    return
}

def data = json.data
if (!data) {
    log.error "Response không có field 'data'"
    return
}

// Lấy project
def project = context.testCase.testSuite.project

// Gán USERNAME, EMAIL, FULLNAME, FIREBASEID từ response
if (data.username) {
    project.setPropertyValue("USERNAME", data.username.toString())
    log.info "Set USERNAME = ${data.username}"
}

if (data.email) {
    project.setPropertyValue("EMAIL", data.email.toString())
    log.info "Set EMAIL = ${data.email}"
}

if (data.fullname) {
    project.setPropertyValue("FULLNAME", data.fullname.toString())
    log.info "Set FULLNAME = ${data.fullname}"
}

if (data.firebase_id) {
    project.setPropertyValue("FIREBASE_ID", data.firebase_id.toString())
    log.info "Set FIREBASE_ID = ${data.firebase_id}"
}

// Cập nhật PASSWORD từ TestCase property upd_new_password
def tc = context.testCase
def newPass = tc.getPropertyValue("upd_new_password")

if (newPass) {
    project.setPropertyValue("PASSWORD", newPass)
    log.info "Set PASSWORD từ TestCase property 'upd_new_password'"
} else {
    log.warn "TestCase property 'upd_new_password' đang rỗng – không cập nhật PASSWORD"
}
</script></con:config></con:testStep><con:properties><con:property><con:name>upd_username</con:name><con:value>u_20251207_124742_b08e02</con:value></con:property><con:property><con:name>upd_old_password</con:name><con:value>Pass470382</con:value></con:property><con:property><con:name>upd_new_password</con:name><con:value>Pass744809</con:value></con:property><con:property><con:name>upd_email</con:name><con:value>user_20251207_164348_013ccd@example.com</con:value></con:property><con:property><con:name>upd_fullname</con:name><con:value>User_20251207_164348</con:value></con:property><con:property><con:name>upd_firebase</con:name><con:value>fb_20251207_164348</con:value></con:property></con:properties></con:testCase><con:testCase id="cdb69e3a-47f1-40bb-b422-b6bf5ed57c29" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="01de917d-57a8-4821-94ff-689431af9e0c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="cfccf2e1-70ff-4b4f-921b-280a4fc0e58e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 1234566"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username": "2hoanglinh1111",
  "email": "user1616111@example.com",
  "fullname": "2hllll",
  "password": "2hoanglinh",
  "firebase_id": "686868686666"
}</con:request><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="8555157d-6381-4d68-a7bf-c572ea1f8e42" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Expected 401 but got ${status}"

def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

assert json.success == false : "success phải = false"

// chỉ cần message chứa cụm 'token not valid' là ok
def msg = (json.message ?: "").toLowerCase()
assert msg.contains("token not valid") :
        "Sai message, expected contain 'token not valid', got: '${json.message}'"

assert json.data instanceof Map : "data phải là object {}"
assert json.data.isEmpty()      : "data phải rỗng {}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="8e60ee0a-bb14-4701-a245-b70f86976b85" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Invalid Char Username" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b2ab9a0b-05cb-4f4f-bdbf-a9ed09e65241"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="cfccf2e1-70ff-4b4f-921b-280a4fc0e58e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username": "đào_hoàng",
  "email": "user1616111zaza@example.com",
  "fullname": "2hllll",
  "password": "2hoanglinh",
  "firebase_id": "686868686666"
}</con:request><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="31cea3c0-3847-4042-9e7d-bac62702ed60" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case username sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case username sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "Username ≥4 ký tự, chỉ gồm chữ/số/_."
        : "Thông báo lỗi username sai. Expected 'Username ≥4 ký tự, chỉ gồm chữ/số/_.', got '${firstMsg}'"

// ==== 5. Không lộ password trong response (phòng hờ) ====
assert !json.containsKey('password') : "Root response không được có field 'password'"
if (json.data instanceof Map) {
    assert !json.data.containsKey('password') :
            "data không được có field 'password'"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="3cf9baf0-aeb2-4548-b828-4c5d648e4f22" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_06_Username Too Long" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="eafb9d44-beb1-4ea2-934a-1bb225d6f47b"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
      "email": "hoang250046uu@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666iioo"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="99e349da-f8ee-4353-b797-53d2ff710f9a" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// --- 0. Kiểm tra có response không ---
assert messageExchange.response, " Không có response trả về"

// --- 1. Kiểm tra HTTP status code ---
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : " Status code phải là 400 cho case username quá dài, hiện tại = ${status}"

// --- 2. Parse JSON body ---
def body = messageExchange.responseContent
assert body, " Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (Exception e) {
    assert false : " Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// --- 3. Kiểm tra field 'success' ---
assert json.success == false : " 'success' phải = false cho case username too long, hiện tại = ${json.success}"

// --- 4. Kiểm tra 'message' ---
assert json.message == "Validation error" : " 'message' phải = 'Validation error', hiện tại = '${json.message}'"

// --- 5. Kiểm tra 'data' là object rỗng ---
assert json.data instanceof Map : " 'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : " 'data' phải rỗng {}, hiện tại = ${json.data}"

// --- 6. Kiểm tra errors.username tồn tại ---
assert json.errors : " Không có field 'errors' trong response"
assert json.errors.username : " Không có lỗi cho field 'username' trong errors"
assert json.errors.username[0] : " errors.username[0] rỗng"

// --- 7. Kiểm tra nội dung thông báo lỗi username ---
def errMsg = (json.errors.username[0] as String).toLowerCase()
def expectedPart = "no more than 150"
assert errMsg.contains(expectedPart) : " Message lỗi username không đúng.\nThực tế: '${errMsg}'\nMong đợi chứa: '${expectedPart}'"

// --- 8. Log cho dễ nhìn trong TestCase Log ---
log.info "✅ Username too long: status=${status}, success=${json.success}, msg='${json.message}', usernameError='${json.errors.username[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="130b94ed-3813-44a0-872e-2a58405b77a7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_07_Invalid Email Format" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="44bfa264-6f8e-4114-aa55-76f0e182da53"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "hoang_dep_traizzz",
      "email": "23020666",
      "fullname": "Đào Huy Hoàng",
      "password": "hoang123####",
      "firebase_id": "666666666666666sssiizz"
}</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7fbf16bb-7db4-4d99-8db8-ff5231d19e2f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case email sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case email sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field email ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List &amp;&amp; json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def firstMsg = json.errors.email[0] as String
assert firstMsg == "Enter a valid email address." :
        "Thông báo lỗi email sai. Expected 'Enter a valid email address.', got '${firstMsg}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="8cb06f5f-fb24-47ec-b85c-08ef31621b89" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_08_Name Already Exists" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="40d6bbdc-cce4-4885-9b2f-9926fb09d9f2"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06",
      "email": "hoang250046cr@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666zcc"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5f5366ba-34f9-48fa-8aa0-55053b65ed98" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case trùng thông tin, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case trùng thông tin thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho từng field ====

// ----- username -----
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def usernameMsg = json.errors.username[0] as String
assert usernameMsg == "This field must be unique." :
        "Thông báo lỗi username sai. Expected 'This field must be unique.', got '${usernameMsg}'"


</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="c6075e68-6c76-4587-9787-eac12591ac3e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_09_Email Already Exists" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="480f0b6f-384c-4de9-9556-a96c11e0929f"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang0aaoke",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666vvv"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="bce04400-ffdd-49ee-b54c-33b268518b49" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// --- 0. Kiểm tra có response không ---
assert messageExchange.response, " Không có response trả về"

// --- 1. Kiểm tra HTTP status code ---
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : " Status code phải là 400 cho case email trùng, hiện tại = ${status}"

// --- 2. Parse JSON body ---
def body = messageExchange.responseContent
assert body, " Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (Exception e) {
    assert false : " Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// --- 3. Kiểm tra field 'success' ---
assert json.success == false : " 'success' phải = false cho case duplicate email, hiện tại = ${json.success}"

// --- 4. Kiểm tra 'message' ---
assert json.message == "Validation error" : " 'message' phải = 'Validation error', hiện tại = '${json.message}'"

// --- 5. Kiểm tra 'data' là object rỗng ---
assert json.data instanceof Map : " 'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : " 'data' phải rỗng {}, hiện tại = ${json.data}"

// --- 6. Kiểm tra errors.email tồn tại ---
assert json.errors : " Không có field 'errors' trong response"
assert json.errors.email : " Không có lỗi cho field 'email' trong errors"
assert json.errors.email[0] : " errors.email[0] rỗng"

// --- 7. Kiểm tra nội dung thông báo lỗi email ---
def errMsg = (json.errors.email[0] as String).toLowerCase()
def expectedPart = "must be unique"
assert errMsg.contains(expectedPart) : " Message lỗi email không đúng.\nThực tế: '${errMsg}'\nMong đợi chứa: '${expectedPart}'"

// --- 8. Log cho dễ debug ---
log.info "✅ Duplicate email: status=${status}, success=${json.success}, msg='${json.message}', emailError='${json.errors.email[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="22cafd5d-d691-4a44-91e1-46a8885739f4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_10_Firebase Id Already Exists" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="64b11235-7a98-4a5f-906b-84054b9c0749"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang0aaoke",
      "email": "hoang250046xx@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "1234567890"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="bce04400-ffdd-49ee-b54c-33b268518b49" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// --- 0. Kiểm tra có response không ---
assert messageExchange.response, " Không có response trả về"

// --- 1. Kiểm tra HTTP status code ---
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : " Status code phải là 400 cho case firebase_id trùng, hiện tại = ${status}"

// --- 2. Parse JSON body ---
def body = messageExchange.responseContent
assert body, " Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (Exception e) {
    assert false : " Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// --- 3. Kiểm tra field 'success' ---
assert json.success == false : " 'success' phải = false cho case duplicate email, hiện tại = ${json.success}"

// --- 4. Kiểm tra 'message' ---
assert json.message == "Validation error" : " 'message' phải = 'Validation error', hiện tại = '${json.message}'"

// --- 5. Kiểm tra 'data' là object rỗng ---
assert json.data instanceof Map : " 'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : " 'data' phải rỗng {}, hiện tại = ${json.data}"

// --- 6. Kiểm tra errors.firebase_id tồn tại ---
assert json.errors : " Không có field 'errors' trong response"
assert json.errors.firebase_id : " Không có lỗi cho field 'firebase_id' trong errors"
assert json.errors.firebase_id[0] : " errors.firebase_id[0] rỗng"

// --- 7. Kiểm tra nội dung thông báo lỗi firebase_id ---
def errMsg = (json.errors.firebase_id[0] as String).toLowerCase()

def expectedPart1 = "firebase id"
def expectedPart2 = "already exists"

assert errMsg.contains(expectedPart1) &amp;&amp; errMsg.contains(expectedPart2) :
    " Message lỗi firebase_id không đúng.\nThực tế: '${errMsg}'\nMong đợi chứa cả: '${expectedPart1}' và '${expectedPart2}'"
// --- 8. Log cho dễ debug ---
log.info "✅ Duplicate firebase_id: status=${status}, success=${json.success}, msg='${json.message}', firebase_idError='${json.errors.firebase_id[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="688767eb-a23b-400d-b18b-1f0d5a5e3e34" name="Del User Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="d2ce773c-eaa7-466c-a1e0-c5111a01aa5a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b463d5f6-de9a-4b42-87df-9df8a13609a6"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 3" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="bbbd79b3-317c-4b7a-8508-27ea3b26016f" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="296fb383-9273-41f1-9a88-15abc72812d7" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "status phải = 200 cho case xóa thành công, hiện tại = ${status}"

// 2. Lấy body &amp; parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Deleted" : "'message' phải = 'Deleted', hiện tại = '${json.message}'"

// 4. Kiểm tra data là object rỗng {}
assert json.data instanceof Map : "'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : "'data' phải rỗng {}, hiện tại = ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckUserDeleted" id="53efb7a9-99eb-4d8f-a149-af6233994f4f"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM users_user
WHERE id = ${#Project#user_id};</con:query><con:assertion type="GroovyScriptAssertion" id="603ea930-eb4c-4e33-a535-38203d4afe4f" name="Script Assertion"><con:configuration><scriptText>// Lấy response XML dạng text
def xmlText = messageExchange.responseContent
log.info "JDBC response = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)

// Lấy giá trị trong thẻ &lt;CNT>
def cntText = root.ResultSet.Row.CNT.text()

assert cntText != null &amp;&amp; cntText != "" : "Không tìm thấy giá trị CNT trong JDBC response"

int cnt = Integer.parseInt(cntText)

// Kiểm tra: phải = 0 thì user mới bị xóa
assert cnt == 0 : "User vẫn còn trong DB, COUNT = ${cnt}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="d5069a5f-48a3-4c40-894f-ee144a1bb27d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="1d2b9ed0-8099-4c07-b329-bed351e4b6e6"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 3" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="bbbd79b3-317c-4b7a-8508-27ea3b26016f" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer  123"/>&#13;
  &lt;con:entry key="Content-Type" value=""/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="f6a0b2cd-11a0-4780-b2c8-6e55d11cb9da" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Expected 401 but got ${status}"

def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

assert json.success == false : "success phải = false"

// chỉ cần message chứa cụm 'token not valid' là ok
def msg = (json.message ?: "").toLowerCase()
assert msg.contains("token not valid") :
        "Sai message, expected contain 'token not valid', got: '${json.message}'"

assert json.data instanceof Map : "data phải là object {}"
assert json.data.isEmpty()      : "data phải rỗng {}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e8ce4049-a7ef-4b87-a7c5-8e8181e5da4e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Delete Twice" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="48566ef2-17ad-4b10-b5b8-4a5594f5648e"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 3" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="bbbd79b3-317c-4b7a-8508-27ea3b26016f" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value=""/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="b4a4d3d8-1e04-4745-ba4d-48fc4139f61a" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Kiểm tra HTTP status (thường là 404 cho 'User not found')
def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 404 cho case xóa lại user không tồn tại, hiện tại = ${status}"

// 2. Lấy body &amp; parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "User not found" : "'message' phải = 'User not found', hiện tại = '${json.message}'"

// 4. Kiểm tra data là object rỗng {}
assert json.data instanceof Map : "'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : "'data' phải rỗng {}, hiện tại = ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="63dc9d14-7dd6-4c1a-8420-afd916226a8b" name="Create Topic Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="0f291244-d918-42d8-8519-8e5990b02f8f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="groovy" name="GS Gen TopicData" id="29423649-67d5-498e-9885-95bc5cc3709d"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.util.Collections

// ===== 1. Generate topic title =====
def now = new Date()
def fmt = new SimpleDateFormat("yyyyMMdd_HHmmss")
def timeStr = fmt.format(now)
def randomSuffix = UUID.randomUUID().toString().substring(0, 6)
def topicTitle = "tv_${timeStr}_${randomSuffix}"

// ===== 2. Generate random Japanese word =====
def allWords = [
    "気持ち",
    "花",
    "花火",
    "気分",
    "嬉しい",
    "悲しい",
    "安い",
    "高い",
    "面白い",
    "楽しい",
    "忙しい",
    "静か",
    "にぎやか",
    "暑い",
    "寒い",
    "新しい",
    "古い",
    "きれい",
    "便利",
    "有名"
]

// Shuffle + pick FIRST WORD as STRING
Collections.shuffle(allWords)
def topicWords = allWords[0]  

// ===== 3. Save property =====
def tc = context.testCase
tc.setPropertyValue("topic_title", topicTitle)
tc.setPropertyValue("topic_words", topicWords)

log.info "Generated topic_title = ${topicTitle}"
log.info "Generated topic_words = ${topicWords}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="c6d7affa-b1d3-4c59-9972-948af4161188"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "title": "${#TestCase#topic_title}",
  "words": "${#TestCase#topic_words}"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="a269c5f6-bebc-4f35-92f1-513e8cc7c5f6" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// Nếu API anh trả 200 thì đổi lại 200.
assert status == 201 : "Status phải = 201 cho case tạo thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "'message' phải = 'Created', hiện tại = '${json.message}'"

// 4. (Optional) Data tồn tại
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetTopicId" id="42686274-5536-4c56-b680-6ae73998538e"><con:settings><con:setting id="discardResponse">false</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT t.id AS topic_id
FROM   notes_topic t
JOIN   notes_note n
       ON t.note_id = n.id
WHERE  n.user_id = ${#Project#user_id}
  AND  t.title    = '${#TestCase#topic_title}'
ORDER BY t.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetTopicId" id="cf6217c5-6e92-417b-926e-7a58c1b064ee"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

def jdbc = context.testCase.testSteps["JDBC GetTopicId"]
def xml = jdbc.getPropertyValue("ResponseAsXml")

def root = new XmlSlurper().parseText(xml)
def row  = root.ResultSet.Row[0]

def topicId = row."NOTES_TOPIC.ID".text()

assert topicId : "Không tìm thấy NOTES_TOPIC.ID trong JDBC!"

context.testCase.testSuite.project.setPropertyValue("topic_id", topicId)

log.info "=> Set Project.topic_id = ${topicId}"
</script></con:config></con:testStep><con:loadTest id="b716a7f2-55e2-4e29-9a37-4a520244dd26" name="CreateTopic_10U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>10</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="1aec248e-089c-4037-a862-6e2441d2fb5a" name="CreateTopic_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="7c5dd0b4-3d9b-4fd5-adaf-18ffb056bd6e" name="CreateTopic_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="46860f3c-ecab-4dd0-b8a6-2e2476cefe6d" name="CreateTopic_200U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="6c107916-b63b-47e6-ad4c-eeb6c0f11678" name="CreateTopic_200_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>topic_title</con:name><con:value>tv_20251209_170827_56f1bb</con:value></con:property><con:property><con:name>topic_words</con:name><con:value>寒い</con:value></con:property></con:properties></con:testCase><con:testCase id="6650682d-3641-4d9a-ba09-0b890ac042c3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="6949d9a7-09dd-4be0-a282-722af4402e63"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv 18/10 v5",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e2668329-fffb-4057-95d8-9bd0d57ded30" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="a350da21-955d-40da-84d0-2e34854d4c0e"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv 18/10 v5",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="19fc4278-51fd-4749-b92b-8a7130ccf4b9" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_Missing Title" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="55a5f7b0-e74a-4edd-9ef8-a9ee09907c81"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="1880b8cb-bfa0-4cd7-98b8-60907655fd2d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 400 : "Status phải = 400 cho case validation error, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "Validation error" : 
    "'message' phải = 'Validation error', hiện tại = '${json.message}'"

// phải có field errors
assert json.errors : "Response phải có field 'errors' chứa chi tiết validate"

// ... phần template Validation error phía trên
assert json.errors.containsKey("title") : "errors phải có key 'title'"</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="bc170590-4dce-4208-b7de-38d4e90d2033" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_05_Empty Title" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="1b4e6be6-c0a9-430c-8654-4e6ac0269239"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="381b2501-e932-484f-a9ba-c3efacd56022" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Kiểm tra HTTP status (thường là 400 cho lỗi validate)
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : "Status phải = 400 cho case title rỗng, hiện tại = ${status}"

// 2. Lấy body &amp; parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra các trường chính
assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "Validation error" : "'message' phải = 'Validation error', hiện tại = '${json.message}'"

// 4. Kiểm tra 'data' rỗng
assert json.data instanceof Map : "'data' phải là object, hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : "'data' phải rỗng, hiện tại = ${json.data}"

// 5. Kiểm tra 'errors.title'
assert json.errors : "Trường 'errors' không tồn tại trong response"
assert json.errors.title : "Trường 'errors.title' không tồn tại trong response"

def titleErrors = json.errors.title
assert titleErrors instanceof List : "'errors.title' phải là mảng, hiện tại = ${titleErrors?.getClass()}"
assert titleErrors.contains("This field may not be blank.") :
    "Thông báo lỗi cho 'title' phải chứa 'not be blank.', hiện tại = ${titleErrors}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="410f1e52-1a21-40b5-ba62-482f0918adba" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_06_Missing/Empty Words" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="1c37c18f-750e-495b-b6e2-8c015ec2cdbb"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv 18/10 v51"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="94669519-8ca0-4137-8f27-146ca3f7e679" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// Nếu API anh trả 200 thì đổi lại 200.
assert status == 201 : "Status phải = 201 cho case tạo thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "'message' phải = 'Created', hiện tại = '${json.message}'"

// 4. (Optional) Data tồn tại
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="b054ff85-3eb1-4293-93b7-59749717dc1e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_07_Duplicate Title" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="2cc61f37-4875-4241-9007-4a8831620fcc"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv 18/10 v5",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5ff7b00e-b929-40bb-b728-706ae7a66f4d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : "Status phải = 400 cho case duplicate title, hiện tại = ${status}"

// 2. Lấy body &amp; parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "Validation error" : 
    "'message' phải = 'Validation error', hiện tại = '${json.message}'"

// 4. Kiểm tra errors.title
assert json.errors : "Response phải có field 'errors'"
assert json.errors.title : "errors phải có key 'title'"

def titleErrors = json.errors.title
assert titleErrors instanceof List &amp;&amp; titleErrors.size() > 0 : "errors.title phải là list và không rỗng"

assert titleErrors[0] == "Title already exists in this note." :
    "Thông báo lỗi title sai, hiện tại = '${titleErrors[0]}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="0e6ee2e6-a256-487a-8664-09d477e8f454" name="Get All Topics Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="3b12998d-1b23-4616-988e-7718698501c7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="e0abf343-34c0-4ece-ae80-5efef7ff9743"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="4653593c-c751-4e0f-91f2-a98eb99a7b18" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="46dd7bca-93da-4059-8a06-c3da4d1a28b6" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Status code
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case get all topics thành công, hiện tại = ${status}"

// 2. Parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

// 4. data phải là list, có ít nhất 1 topic
assert json.data instanceof List : "'data' phải là list, hiện tại = ${json.data?.getClass()}"
assert json.data.size() > 0 : "'data' phải có ít nhất 1 topic, hiện tại size = ${json.data.size()}"

// 5. kiểm tra structure của từng topic
json.data.eachWithIndex { topic, idx ->
    assert topic.id        != null : "Topic [${idx}] phải có 'id'"
    assert topic.title     != null : "Topic [${idx}] phải có 'title'"
    assert topic.vocas     != null : "Topic [${idx}] phải có 'vocas' (có thể rỗng nhưng vẫn phải có key)"
    assert topic.created_at != null : "Topic [${idx}] phải có 'created_at'"
    assert topic.updated_at != null : "Topic [${idx}] phải có 'updated_at'"

    // đảm bảo kiểu dữ liệu hợp lý
    assert topic.id instanceof Number : "Topic [${idx}].id phải là Number, hiện tại = ${topic.id?.getClass()}"
    assert topic.title instanceof String : "Topic [${idx}].title phải là String"
    assert topic.vocas instanceof String : "Topic [${idx}].vocas phải là String"

    // đảm bảo không có field nhạy cảm (note, user, v.v.)
    def forbiddenKeys = ["note", "user", "voca_topics", "details"]
    forbiddenKeys.each { key ->
        assert !topic.containsKey(key) : "Topic [${idx}] không được chứa field nhạy cảm '${key}'"
    }
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:loadTest id="0ba6794c-3765-48de-9f0b-ddb43e451062" name="GetAllTopics_10U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>10</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="2ded4ff6-5f6a-4c02-8e9f-a0762934d668" name="GetAllTopics_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="6fb85d0b-cc43-4eed-b4f7-ecef7269b06f" name="GetAllTopics_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="552bfffe-aec0-47e2-8f0c-d79dba703e7f" name="GetAllTopics_200U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="fd6a8f99-02f8-4346-b5f1-cb38c0c9dcba" name="GetAllTopics_250U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>250</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>120</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="896770db-6c9d-47ef-a7bf-ce1eb847070b" name="GetAllTopics_30U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>30</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>180</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.8</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="ea82ea77-20b9-452d-b87e-879235629757" name="GetAllTopics_200U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>180</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.8</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="32f89cec-73c1-4dc3-9947-76c29c043b1d" name="GetAllTopics_Spike_150U"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>60000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="9edf0643-7de4-4731-9d60-dd5c4bfcfaf2" name="GetAllTopics_100U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>1800</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>2500</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:testCase id="8d101ea9-7fe9-42d7-80a8-e6b20a2671a4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="5a4f37ea-5d6f-4efb-ac3b-e6be9917e460"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="d01e524a-c1f4-4ef2-af25-944e7cecb545" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="a382b7ab-d1d3-4390-8ce8-8cf22fe1ab4d"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="cedf55b2-f592-47c7-8760-e950b9e6a5e2" name="Get Search Topics Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="c4148cf7-828a-40ed-af2d-ab0f6d0bc15f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="JDBC GetRandomTopicTitle" id="c9c12255-43d1-4542-9e61-aa26d88d1c3b"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT t.title AS topic_title
FROM   notes_topic t
JOIN   notes_note n ON t.note_id = n.id
WHERE  n.user_id = ${#Project#user_id}
ORDER BY RAND()
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="6f87f5a7-243a-486f-bda4-12dd88ff0e3d" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent       // nếu là Script Assertion
// nếu là Groovy Step sau JDBC thì dùng:
// def xmlText = context.testCase.testSteps["JDBC GetTopicTitle"].getPropertyValue("ResponseAsXml")

log.info "JDBC_GetTopicTitle Response = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)
def row  = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC!"

// Lấy giá trị &lt;NOTES_TOPIC.TITLE>
def topicTitle = row."NOTES_TOPIC.TITLE".text()
assert topicTitle : "Không đọc được NOTES_TOPIC.TITLE từ JDBC result!"

// Gán vào Project property để dùng cho Search Topic
def project = context.testCase.testSuite.project
project.setPropertyValue("search_text", topicTitle)
project.setPropertyValue("topic_title", topicTitle)

log.info "Set Project#search_text = ${topicTitle}"
log.info "Set Project#topic_title = ${topicTitle}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetSearchText" id="bcd3bc02-29d0-4f4d-869f-f1ba8fa82895"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

// Lấy step JDBC
def jdbc = context.testCase.testSteps["JDBC GetRandomTopicTitle"]
def xml  = jdbc.getPropertyValue("ResponseAsXml")
log.info "RandomTopicTitle XML = ${xml}"

// Parse XML
def root = new XmlSlurper().parseText(xml)
def row  = root.ResultSet.Row[0]
assert row != null : "Không tìm thấy topic nào trong DB cho user này!"

// Lấy giá trị &lt;NOTES_TOPIC.TITLE>
def topicTitle = row."NOTES_TOPIC.TITLE".text()
assert topicTitle : "Không đọc được NOTES_TOPIC.TITLE!"

// Gán vào Project properties để dùng cho Search Topic / log
def project = context.testCase.testSuite.project
project.setPropertyValue("search_text", topicTitle)
project.setPropertyValue("topic_title", topicTitle)

log.info "Picked topic_title for search = ${topicTitle}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="622e63e3-e457-4712-a0c8-f7de6e41e8b6"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/search/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="829f4a89-4e5d-464a-870a-085b5e36baf1" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/search/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ff4fa8bf-4796-4f5d-9af3-67ca2676c69a" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case search thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 1. success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

// 2. data phải là list, có ít nhất 1 kết quả
assert json.data instanceof List : "'data' phải là list, hiện tại = ${json.data?.getClass()}"
assert json.data.size() > 0 : "Search q='tv' phải trả về ít nhất 1 topic, hiện tại size = ${json.data.size()}"

// 3. kiểm tra structure + title phải chứa 'tv'
def query = "tv".toLowerCase()

json.data.eachWithIndex { topic, idx ->
    assert topic.id         != null : "Topic [${idx}] phải có 'id'"
    assert topic.title      != null : "Topic [${idx}] phải có 'title'"
    assert topic.vocas      != null : "Topic [${idx}] phải có 'vocas'"
    assert topic.created_at != null : "Topic [${idx}] phải có 'created_at'"
    assert topic.updated_at != null : "Topic [${idx}] phải có 'updated_at'"

    // kiểu dữ liệu cơ bản
    assert topic.id instanceof Number : "Topic [${idx}].id phải là Number, hiện tại = ${topic.id?.getClass()}"
    assert topic.title instanceof String : "Topic [${idx}].title phải là String"
    assert topic.vocas instanceof String : "Topic [${idx}].vocas phải là String"

    // title phải chứa query 'tv' (case-insensitive)
    def titleStr = topic.title.toString().toLowerCase()
    assert titleStr.contains(query) :
        "Topic [${idx}].title = '${topic.title}' không chứa query '${query}'"

    // không có field nhạy cảm
    def forbiddenKeys = ["note", "user", "voca_topics", "details"]
    forbiddenKeys.each { key ->
        assert !topic.containsKey(key) : "Topic [${idx}] không được chứa field nhạy cảm '${key}'"
    }
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#search_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>q</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:loadTest id="675ec05d-63ec-4be3-beb0-ccb9328e7d3a" name="Search_20U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>20</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="ce890a63-5fe5-416e-82db-e14db6519a8a" name="Search_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="f86ace06-1b84-43f1-8c1e-c5f77738ebf4" name="Search_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="3b6ebbd5-5962-4a1b-b96f-1e2c7b02d9e0" name="Search_150U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="9c22d398-b8f5-4188-a937-b84b7cf5afad" name="Search_250U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>250</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="12cb93b2-35a9-4fed-9c8c-7e02cb3d1789" name="Search_100U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>180</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>20000</interval><variance>0.6</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="4440a9a0-e1c8-4c5e-8f84-8871aab2c943" name="Search_250U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>250</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>180</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>20000</interval><variance>0.6</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="66ac581a-3166-43e6-88b6-7e4a3ecce4e8" name="Search_200U_Spike"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>10000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="d1a78829-b694-489f-9571-486592c489ce" name="Search_100U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>1800</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:testCase id="0b8ba48d-14cd-4edf-a41a-518bcb093cc3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_No Result" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="0b74c831-9b73-4113-9b02-28a5582745a1"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/search/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="829f4a89-4e5d-464a-870a-085b5e36baf1" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/search/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="635649c9-31d5-4659-9cdb-cf11f0efc369" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case search không có kết quả, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

assert json.data instanceof List : "'data' phải là list"
assert json.data.size() == 0 : "Search q='xxxxx' thì 'data' phải rỗng, hiện tại size = ${json.data.size()}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="abc" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>q</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="6ebd8995-3b51-4ea9-a08d-bfab1ee8f6e3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="7b66da83-01fd-4ef2-b469-ae05b98a8265"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/search/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#topic_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="0b9243a4-dfc8-4c11-a887-feee16ef972d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b3b7cd6b-d084-400b-af8d-992569fa43bb"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/search/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#topic_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="b7b53d82-0b69-44a9-bc62-7c92afde38d2" name="Get Topic By Id Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="08eae89c-9c67-45cb-8912-aa6d09b00fe3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b8349068-4e5d-411f-915e-5879e3ae86f5"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="86b783fb-a66f-4c3a-8cd5-81c1b893b166" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6f8dc7f4-30e0-40d5-9c61-195137299a5f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case get topic by id thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 1. success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

// 2. data phải là object
assert json.data instanceof Map : "'data' phải là object (Map), hiện tại = ${json.data?.getClass()}"

def topic = json.data

// 3. kiểm tra field bắt buộc
assert topic.id         != null : "Topic phải có 'id'"
assert topic.title      != null : "Topic phải có 'title'"
assert topic.vocas      != null : "Topic phải có 'vocas'"
assert topic.created_at != null : "Topic phải có 'created_at'"
assert topic.updated_at != null : "Topic phải có 'updated_at'"

// 4. kiểu dữ liệu cơ bản
assert topic.id instanceof Number  : "'id' phải là Number, hiện tại = ${topic.id?.getClass()}"
assert topic.title instanceof String : "'title' phải là String"
assert topic.vocas instanceof String : "'vocas' phải là String"

// 5. không trả về field nhạy cảm
def forbiddenKeys = ["note", "user", "voca_topics", "details"]
forbiddenKeys.each { key ->
    assert !topic.containsKey(key) : "Topic không được chứa field nhạy cảm '${key}'"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:loadTest id="8576b069-90ac-4751-8d93-c9ae264acae0" name="GetTopicById_20U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>20</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="29e73173-8ea6-4c7e-ba84-1e30beb89f6f" name="GetTopicById_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="158d4a3d-ab91-4376-af55-814fd43491d1" name="GetTopicById_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="16a5985c-f98d-4062-9460-c85108bb1807" name="GetTopicById_250U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>250</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="110802fa-0fa1-4583-974f-11e81b3f38e5" name="GetTopicById_80U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.8</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="b04d7754-6cca-41d6-8735-cdc44e8416d7" name="GetTopicById_200U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.8</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="7b264681-2c34-450a-be9b-5c563d02ffc2" name="GetTopicById_200U_Spike"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>200</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>10000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="55b69678-ca46-4d26-a8a2-01009a44b941" name="GetTopicById_100U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>600</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:testCase id="1615600a-72e8-4287-9cf6-d4ae1a4027f6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_Not Found" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="4d278bf3-6582-4a20-ad39-344e9ed4b294"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="86b783fb-a66f-4c3a-8cd5-81c1b893b166" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5dc0eda4-4082-40e5-a6ae-efc647056954" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Status code phải = 404
def status = messageExchange.responseStatusCode as Integer
assert status == 404 : "Status phải = 404 cho case topic không tồn tại, hiện tại = ${status}"

// 2. Parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "No Topic matches the given query." :
    "'message' phải = 'No Topic matches the given query.', hiện tại = '${json.message}'"

// 4. data phải là object rỗng
assert json.data instanceof Map : "'data' phải là object (Map), hiện tại = ${json.data?.getClass()}"
assert json.data.isEmpty() : "'data' phải rỗng {}, hiện tại = ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="topic_id" value="999" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="d827d703-439d-44b1-b1b2-b47136b07440" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="e4aae5e8-5ecf-47d7-be0b-06d00a0d225a"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#topic_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="0f96a946-ab81-441d-a4f5-0460af882d67" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="b2e39c87-da60-41e1-a22f-5d53dd827be3"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#topic_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="faa7de73-ece5-408e-b944-22d7d3b694ac" name="Post Add Word"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="e779fc57-3ab4-4472-b0e6-37dfbc5fc6f6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Gen WordData" id="b23f4a5d-508b-4d64-ad8b-de5dd52975d7"><con:settings/><con:config><script>import java.util.Collections

// ===== 1. List từ vựng để random =====
def allWords = [
    "気持ち",   // cảm xúc
    "花",       // hoa
    "花火",     // pháo hoa
    "気分",     // tâm trạng
    "嬉しい",   // vui
    "悲しい",   // buồn
    "安い",     // rẻ
    "高い",     // đắt
    "面白い",   // thú vị
    "楽しい",   // vui vẻ
    "忙しい",   // bận rộn
    "静か",     // yên tĩnh
    "にぎやか", // náo nhiệt
    "暑い",     // nóng
    "寒い",     // lạnh
    "新しい",   // mới
    "古い",     // cũ
    "きれい",   // đẹp, sạch
    "便利",     // tiện lợi
    "有名"      // nổi tiếng
]

// Xáo trộn &amp; lấy 1 từ bất kỳ
Collections.shuffle(allWords)
def word = allWords[0]

// ===== 2. Ghi vào Project property add_word =====
def proj = context.testCase.testSuite.project
proj.setPropertyValue("add_word", word)

// Log cho dễ debug
log.info "Generated add_word = ${word}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="ca4d4fbe-ebdf-4617-8657-88fa8b60a394"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="23cb86c0-242e-4088-81a3-927f7820b6e7" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// nếu backend trả 201 thì sửa lại 201
assert status == 200 : "Status phải = 200 cho case add-word thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Words added successfully" :
    "'message' phải = 'Words added successfully', hiện tại = '${json.message}'"

// phải có field data (dù là chuỗi rỗng)
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaId" id="ce7d7004-9c81-4ba8-8c07-e4e5214e65b2"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id AS voca_id
FROM notes_voca
WHERE word = '${#Project#add_word}'
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="e129a905-c84e-46ed-8e58-d1f65170db6c" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// 1. Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent
log.info "JDBC_GetVocaId Response = ${xmlText}"

// 2. Parse XML
def root = new XmlSlurper().parseText(xmlText)

// 3. Lấy dòng đầu tiên (nếu có)
def row = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC (không tìm thấy voca)"

// 4. Lấy giá trị &lt;NOTES_VOCA.ID>
def vocaId = row."NOTES_VOCA.ID".text()
assert vocaId : "Không đọc được NOTES_VOCA.ID từ JDBC result!"

// 5. (Tuỳ chọn) Ghi luôn vào Project property để dùng ở bước sau
def project = context.testCase.testSuite.project
project.setPropertyValue("add_word_id", vocaId)

log.info "Assertion OK - voca_id = ${vocaId}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckVocaTopic" id="1ab31432-4cc1-4bad-8528-bfe24733af58"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM notes_vocatopic
WHERE topic_id = ${#Project#topic_id}
  AND voca_id  = ${#Project#add_word_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="4aece3c5-2971-4e95-b78c-27cf3cd4e5c7" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)
def cnt  = root.ResultSet.Row[0].CNT.text() as Integer

def topicId = context.expand('${#Project#topic_id}')
def vocaId  = context.expand('${#Project#voca_id}')

log.info "Check mapping: topic_id=${topicId}, voca_id=${vocaId}, count=${cnt}"

assert cnt == 1 : "Không tìm thấy dòng mapping trong notes_vocatopic (topic_id=${topicId}, voca_id=${vocaId})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:loadTest id="046d8b44-e388-44c0-9968-0d6aac3f0237" name="AddWord_20U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>20</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>2500</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="5ac85698-2bfa-4fff-99fe-e2ea5d07ae8d" name="AddWord_50U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>2500</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="488e1a1b-8a4d-478d-a627-c48233f9f026" name="AddWord_100U_Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type><con:config><testDelay>2500</testDelay><randomFactor>0.5</randomFactor></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="08338713-c13e-4be6-97c4-70cbaee7e5bc" name="AddWord_150U_Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.6</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="8b73cdf3-84c8-461e-9c2e-64c7f08e59ff" name="AddWord_150U_Spike"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>20000</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="4a685124-2d17-4c36-99af-faed5107c7f9" name="AddWord_150U_Soak"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>150</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>600</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:testCase id="c92eec1f-d8b3-44ad-81cb-10f485742de7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_Topic Not Found" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="c6f84d11-dfc8-4326-80ce-0fe1b55a1a57"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="a9b9d160-7f57-43fa-9a44-9d4755d54473" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 404 : "Status phải = 404 cho case topic không tồn tại, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "No Topic matches the given query." :
    "'message' phải = 'No Topic matches the given query.', hiện tại = '${json.message}'"

assert json.data instanceof Map : "'data' phải là object (Map)"
assert json.data.isEmpty() : "'data' phải rỗng {}, hiện tại = ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="topic_id" value="999" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="b5b26037-30aa-49ad-950d-d0f3c05bc02e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="02cccf91-4d14-49e5-8a50-735bd78862db"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#Project#topic_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="46d97478-9ba7-4249-a5a9-e6035474058d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="565ea184-2290-47fd-9366-bbb9e461f8f2"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#Project#add_word}"/>
  <con:entry key="q" value="${#Project#topic_text}"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="9c703d96-c271-4d45-b735-40db1e9636bc" name="Del Word"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="0e364209-66f2-4ab8-b9a2-e8a5338dbbf8" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_01_Success" searchProperties="true"><con:settings/><con:testStep type="jdbc" name="JDBC GetVocaIds" id="0445e892-88c5-4251-be43-08e7cf0ec1ff"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT vt.id  AS voca_topic_id,
       vd.id  AS voca_detail_id
FROM   notes_vocatopic vt
JOIN   notes_voca v
       ON vt.voca_id = v.id
JOIN   notes_vocadetail vd
       ON vd.voca_topic_id = vt.id
WHERE  vt.topic_id = ${#Project#topic_id}
  AND  v.word      = '${#Project#add_word}'
ORDER BY vd.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetVocaIds" id="7de0fe14-8ef1-4615-973d-fcf7fd4eac89"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

// Lấy step JDBC – TÊN PHẢI TRÙNG 100% VỚI STEP CỦA ANH
def jdbc = context.testCase.testSteps["JDBC GetVocaIds"]

// Lấy XML kết quả
def xmlText = jdbc.getPropertyValue("ResponseAsXml")
log.info "JDBC_GetVocaIds ResponseAsXml = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)
def row  = root.ResultSet.Row[0]

// Lấy 2 ID từ tag có dấu chấm
def vocaTopicId  = row."NOTES_VOCATOPIC.ID".text()
def vocaDetailId = row."NOTES_VOCADETAIL.ID".text()

assert vocaTopicId  : "Không lấy được NOTES_VOCATOPIC.ID!"
assert vocaDetailId : "Không lấy được NOTES_VOCADETAIL.ID!"

// Gán vào Project properties
def project = context.testCase.testSuite.project
project.setPropertyValue("vocal_topic_id",  vocaTopicId)
project.setPropertyValue("vocal_detail_id", vocaDetailId)

log.info "Set Project#voca_topic_id  = ${vocaTopicId}"
log.info "Set Project#voca_detail_id = ${vocaDetailId}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="REST Request" id="9aeac17e-9260-41a4-9375-f70217bfa4d0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="b61ca1b8-2714-4776-98bd-b650cba7f63f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseHeaders['#status#'][0]
assert status.contains('200') : "Expected 200, got: ${status}"

def raw = messageExchange.response.responseContent
assert raw : "Empty response"

def json = new JsonSlurper().parseText(raw)

assert json.success == true : "success != true : ${json.success}"
assert json.message == "Deleted" : "message != 'Deleted' : ${json.message}"
assert json.data instanceof Map : "data must be object, got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="vocal_detail_id" value="${#Project#vocal_detail_id}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckDeleted" id="b6f232df-34fb-4cc5-8e2a-90ebeaf7d9a7"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM   notes_vocadetail vd
JOIN   notes_vocatopic vt ON vd.voca_topic_id = vt.id
WHERE  vd.id = ${#Project#vocal_detail_id}
  AND  vt.id = ${#Project#vocal_topic_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="056ff655-d8d0-47fe-9268-3195c34d5e33" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// JDBC trả về XML trong messageExchange.responseContent
def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)

// Lấy COUNT(*) alias CNT
def row = root.ResultSet.Row[0]
def cnt = row.CNT.text() as Integer   // &lt;CNT>0&lt;/CNT>

log.info "DB count for deleted voca_detail = ${cnt}"

// Mong muốn: không còn bản ghi nào
assert cnt == 0 : "Expected 0 record after delete, but found ${cnt} in DB"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="5be53710-2fe0-47dc-957e-a0c06b34ba83" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_02_Topic Not Found" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="4644e2d0-a5f9-45ac-bf9b-f801983d24c5"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ef3873f6-41c6-4915-b75c-0f73ebd47845" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra status code (giả sử API trả 404 Not Found)
// Nếu backend dùng 400 thì đổi '404' thành '400' là được.
def statusLine = messageExchange.responseHeaders['#status#'][0]   // vd: "HTTP/1.1 404 Not Found"
assert statusLine.contains('404') : "Expected status 404 but got: ${statusLine}"

// 2. Lấy response body
def raw = messageExchange.response.responseContent
assert raw : "Response body is empty"

// 3. Parse JSON
def json = new JsonSlurper().parseText(raw)

// 4. success phải = false
assert json.success == false : "Field 'success' must be false but got: ${json.success}"

// 5. message phải đúng nội dung
assert json.message == "No Topic matches the given query." : 
       "Field 'message' must be 'No Topic matches the given query.' but got: ${json.message}"

// 6. data phải là object rỗng {}
assert json.data instanceof Map : "Field 'data' must be an object but got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "Field 'data' must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#Project#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="999"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="0b272d81-946f-4989-be71-67e07d6d9611" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_03_Voca Topic Not Belong To Topic" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="3f6182da-c5e6-4ae5-b08d-68cb476bf148"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c5410358-6328-456b-b350-a9799a0a1bab" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra status code (giả sử API trả 404 Not Found)
// Nếu backend trả 400 thì đổi '404' thành '400' là được.
def statusLine = messageExchange.responseHeaders['#status#'][0]   // ví dụ: "HTTP/1.1 404 Not Found"
assert statusLine.contains('404') : "Expected status 404 but got: ${statusLine}"

// 2. Lấy response body
def raw = messageExchange.response.responseContent
assert raw : "Response body is empty"

// 3. Parse JSON
def json = new JsonSlurper().parseText(raw)

// 4. success phải = false
assert json.success == false : "Field 'success' must be false but got: ${json.success}"

// 5. message phải đúng nội dung
assert json.message == "No VocaTopic matches the given query." :
       "Field 'message' must be 'No VocaTopic matches the given query.' but got: ${json.message}"

// 6. data phải là object rỗng {}
assert json.data instanceof Map : "Field 'data' must be an object but got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "Field 'data' must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="49"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#Project#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="404e2b0f-1da4-478b-b322-5737376bb9b0" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_04_Voca Detail Not Found" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="d2fa203a-f004-4771-a2d4-406efc4017d9"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="98ff9d2f-4bf7-4960-9fa8-7a3b2b679605" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy body
def raw = messageExchange.response.responseContent
assert raw : "Response body is empty"

// Parse JSON
def json = new JsonSlurper().parseText(raw)

// success phải = false
assert json.success == false : "Expected success=false but got: ${json.success}"

// message đúng nội dung
assert json.message == "No VocaDetail matches the given query." :
       "Unexpected message: ${json.message}"

// data phải là object rỗng {}
assert json.data instanceof Map : "data must be an object but got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#Project#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="99"/>
  <con:entry key="topic_id" value="${#Project#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="56d77635-2644-4b8d-990a-678e822c58b0" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_05_Delete Twice" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request 1" id="e2413e53-f057-4869-803f-2587e0eb3cb1"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request 1" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="e10c1b43-59b9-4e08-9e66-1039a9497fd3" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseHeaders['#status#'][0]
assert status.contains('200') : "Expected 200, got: ${status}"

def raw = messageExchange.response.responseContent
assert raw : "Empty response"

def json = new JsonSlurper().parseText(raw)

assert json.success == true : "success != true : ${json.success}"
assert json.message == "Deleted" : "message != 'Deleted' : ${json.message}"
assert json.data instanceof Map : "data must be object, got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#Project#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#Project#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="REST Request 2" id="9e8d5cfb-6806-4c41-8771-d9f8ca9fad7d"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request 2" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="f00d2c26-859a-48ee-8d23-ccdfbebb700d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy body
def raw = messageExchange.response.responseContent
assert raw : "Response body is empty"

// Parse JSON
def json = new JsonSlurper().parseText(raw)

// success phải = false
assert json.success == false : "Expected success=false but got: ${json.success}"

// message đúng nội dung
assert json.message == "No VocaDetail matches the given query." :
       "Unexpected message: ${json.message}"

// data phải là object rỗng {}
assert json.data instanceof Map : "data must be an object but got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#Project#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#Project#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="e322f3c8-7066-444c-901d-ba6315be43e6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_06_NoToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="4a6467b0-5af8-4c0b-a540-5a356d85bf69"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6e49dca8-86a2-46f9-bdc1-0a042c2183c8" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case không có token, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"

// check message chỉ cần chứa 1 cụm từ → đỡ cứng
assert json.message?.toLowerCase()?.contains("authentication") : 
    "'message' phải chứa 'Authentication', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#Project#add_word}"/>
  <con:entry key="q" value="${#Project#topic_text}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="{topic_id"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="0a89cc61-912b-48f2-85e7-e079c45001d7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_07_InvalidToken Unauthorized" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="20bd92a0-ae4c-42b7-8905-36d8deccf9a2"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer 123"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2629601d-8397-4102-8aa2-3480f97a1611" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 401 : "Status phải = 401 cho case token không hợp lệ, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message?.toLowerCase()?.contains("token not valid") : 
    "'message' phải chứa 'token not valid', hiện tại = '${json.message}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#Project#add_word}"/>
  <con:entry key="q" value="${#Project#topic_text}"/>
  <con:entry key="vocal_detail_id" value="${#Project#vocal_detail_id}"/>
  <con:entry key="topic_id" value="{topic_id"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="7014bc37-5add-4c14-b0dc-5cf5cd289708" name="Workflow Testsuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="3efb2477-dbc3-4b52-b380-91b5e0219d9f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_01_SignUp_LoginFail_CreateTopic" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:settings/><con:testStep type="calltestcase" name="Sign up" id="e3c6e268-3342-4de2-81a6-8edc94a25869"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>93af7c69-0eb5-48e6-aabb-31ccf8aadc92</con:targetTestCase><con:properties><con:property><con:name>username</con:name></con:property><con:property><con:name>email</con:name></con:property><con:property><con:name>fullname</con:name></con:property><con:property><con:name>password</con:name></con:property><con:property><con:name>firebaseId</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Login fail (Wrong Username/password)" id="6b1276ce-2bda-4b71-ac53-fc112db0384c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Login fail (Wrong Username/password)" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "hhhhhh", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="calltestcase" name="Create topic" id="0f29dd9b-08ad-499a-96b0-71a64ac7ecd0"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0f291244-d918-42d8-8519-8e5990b02f8f</con:targetTestCase><con:properties><con:property><con:name>topic_title</con:name></con:property><con:property><con:name>topic_words</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="8a3767fd-c81c-4105-8510-0919a8d34555" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_02_SignUp_Login_CreateTopic_AddWord_GetTopic" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Sign up" id="570e03f3-be79-433b-a6af-b526336a5b4b"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>93af7c69-0eb5-48e6-aabb-31ccf8aadc92</con:targetTestCase><con:properties><con:property><con:name>username</con:name></con:property><con:property><con:name>email</con:name></con:property><con:property><con:name>fullname</con:name></con:property><con:property><con:name>password</con:name></con:property><con:property><con:name>firebaseId</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Login" id="46931e7c-78fe-4d7c-bda8-2da802aa004f"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Create topic" id="805b75ba-8d4a-4575-989f-a6577280f38b"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0f291244-d918-42d8-8519-8e5990b02f8f</con:targetTestCase><con:properties><con:property><con:name>topic_title</con:name></con:property><con:property><con:name>topic_words</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Add word" id="2a23333b-6b90-459b-8507-c6311a7c1d76"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e779fc57-3ab4-4472-b0e6-37dfbc5fc6f6</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Get topic" id="b8700946-1a5f-4cbd-adcc-7ce08d57a2b4"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>08eae89c-9c67-45cb-8912-aa6d09b00fe3</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="ce34cbbe-93d6-4350-85a6-2de1eddd99d2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_03_Login_CreateTopic_AddWord_DeleteWord" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Login" id="f08b10ae-6a5e-47a4-ba40-cdf54a9fbe01"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Create Topic" id="7a7a4e3f-51ce-4616-9f1d-0ebcea271b32"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0f291244-d918-42d8-8519-8e5990b02f8f</con:targetTestCase><con:properties><con:property><con:name>topic_title</con:name></con:property><con:property><con:name>topic_words</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Add Word" id="4fb6b82d-d39e-4bc8-9895-ea8c5fdb09bf"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e779fc57-3ab4-4472-b0e6-37dfbc5fc6f6</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Delete Word" id="69c2cf1f-d2cf-4e67-94ad-a7bafdac077c"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0e364209-66f2-4ab8-b9a2-e8a5338dbbf8</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties><con:property><con:name>topic_title</con:name><con:value/></con:property><con:property><con:name>topic_words</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="05833509-aeea-445f-b458-1bb02a8c5a3a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_04_Login_CreateTopic Fail_AddWord_DeleteWord" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Login" id="4df24120-d759-4cbe-9f7d-60e4a29235f8"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Create Topic Fail ( Duplicate Title)" id="0f39a791-a7dc-4b4e-874f-5df507725a0f"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Create Topic Fail ( Duplicate Title)" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
    "title": "tv_20251207_124743_9227e7",
    "words": "気持ち、花"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5ff7b00e-b929-40bb-b728-706ae7a66f4d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 0. Có response không
assert messageExchange.response, "Không có response trả về"

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 400 : "Status phải = 400 cho case duplicate title, hiện tại = ${status}"

// 2. Lấy body &amp; parse JSON
def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == false : "'success' phải = false, hiện tại = ${json.success}"
assert json.message == "Validation error" : 
    "'message' phải = 'Validation error', hiện tại = '${json.message}'"

// 4. Kiểm tra errors.title
assert json.errors : "Response phải có field 'errors'"
assert json.errors.title : "errors phải có key 'title'"

def titleErrors = json.errors.title
assert titleErrors instanceof List &amp;&amp; titleErrors.size() > 0 : "errors.title phải là list và không rỗng"

assert titleErrors[0] == "Title already exists in this note." :
    "Thông báo lỗi title sai, hiện tại = '${titleErrors[0]}'"
</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="3b382e4e-4a7d-4ccf-8077-e6de8583343c" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// Nếu API anh trả 200 thì đổi lại 200.
assert status == 201 : "Status phải = 201 cho case tạo thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "'message' phải = 'Created', hiện tại = '${json.message}'"

// 4. (Optional) Data tồn tại
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="calltestcase" name="Add Word" id="a808ba15-12e5-41fe-a72a-00295d89f7ba"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e779fc57-3ab4-4472-b0e6-37dfbc5fc6f6</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Delete Word" id="b45767a7-7d3e-42bb-ad06-0dfecd7a1b75"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0e364209-66f2-4ab8-b9a2-e8a5338dbbf8</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties><con:property><con:name>topic_title</con:name><con:value/></con:property><con:property><con:name>topic_words</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="7e6c0d53-335a-4c83-a8a8-a2f7be5694ed" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_05_Login_SearchTopic_AddWord_DeleteWord" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Login" id="e4afd9f5-be89-4d1e-9aa2-1c992c8f414b"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Search Topic" id="7ca4d315-fbf8-4875-85e1-1b27fb953cbf"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>c4148cf7-828a-40ed-af2d-ab0f6d0bc15f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Add Word" id="da0480ce-9989-4fd7-beb5-f9b29b653582"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e779fc57-3ab4-4472-b0e6-37dfbc5fc6f6</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="calltestcase" name="Delete Word" id="65ece81a-8398-4c63-b84b-e6d8e00ac813"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>0e364209-66f2-4ab8-b9a2-e8a5338dbbf8</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:properties><con:property><con:name>topic_title</con:name><con:value/></con:property><con:property><con:name>topic_words</con:name><con:value/></con:property></con:properties></con:testCase><con:testCase id="25c83c45-3698-4282-994b-9d896f166c7d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_06_Login_GetInfor_UpdateInfor_GetInfor" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Login" id="130bdb1b-17e4-4bb9-ac94-7322e6b71da1"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 1" id="395603b8-9e2d-41dd-a42a-fbdb5fa6ad74"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 1" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ Project (do JDBC step set trước đó)
def expectedUsername = context.expand('${#Project#username}')
def expectedEmail    = context.expand('${#Project#email}')
def expectedFullname = context.expand('${#Project#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email == expectedEmail       : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="6182644b-caf4-4318-9738-1973cd6af26a" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

// Lưu lại thông tin cũ
tc.setPropertyValue("old_username",   data.username?.toString() ?: "")
tc.setPropertyValue("old_email",      data.email?.toString() ?: "")
tc.setPropertyValue("old_fullname",   data.fullname?.toString() ?: "")
tc.setPropertyValue("old_firebase",   data.firebase_id?.toString() ?: "")

log.info "Saved old info: username=${data.username}, email=${data.email}, fullname=${data.fullname}, firebase_id=${data.firebase_id}"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="calltestcase" name="Update Infor" id="a56b80c5-7923-47e7-be77-e988cb0afc2b"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>b0c030d0-0ba5-4269-8ec7-3a5c9d9924b7</con:targetTestCase><con:properties><con:property><con:name>upd_username</con:name></con:property><con:property><con:name>upd_old_password</con:name></con:property><con:property><con:name>upd_new_password</con:name></con:property><con:property><con:name>upd_email</con:name></con:property><con:property><con:name>upd_fullname</con:name></con:property><con:property><con:name>upd_firebase</con:name></con:property></con:properties><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 2" id="98f0b902-f565-4975-9cbb-a25f93257d7b"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 2" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ Project (do JDBC step set trước đó)
def expectedUsername = context.expand('${#Project#username}')
def expectedEmail    = context.expand('${#Project#email}')
def expectedFullname = context.expand('${#Project#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email == expectedEmail       : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="7378ca09-27d7-4989-a98f-4f739ca51867" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

def oldUsername = tc.getPropertyValue("old_username")
def oldEmail    = tc.getPropertyValue("old_email")
def oldFullname = tc.getPropertyValue("old_fullname")
def oldFirebase = tc.getPropertyValue("old_firebase")

log.info "Old fullname   = ${oldFullname} | New fullname   = ${data.fullname}"
log.info "Old email      = ${oldEmail}    | New email      = ${data.email}"
log.info "Old firebase   = ${oldFirebase} | New firebase   = ${data.firebase_id}"

// Ví dụ: username giữ nguyên
assert data.username?.toString() == oldUsername : "USERNAME sau update bị đổi, không mong muốn!"

// Các field còn lại PHẢI khác (vì anh vừa update)
assert data.fullname?.toString()   != oldFullname : "FULLNAME không thay đổi sau update!"
assert data.email?.toString()      != oldEmail    : "EMAIL không thay đổi sau update!"
assert data.firebase_id?.toString() != oldFirebase : "FIREBASE_ID không thay đổi sau update!"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>old_username</con:name><con:value>u_20251209_235551_e06757</con:value></con:property><con:property><con:name>old_email</con:name><con:value>u_20251209_235551_e06757@testmail.com</con:value></con:property><con:property><con:name>old_fullname</con:name><con:value>User 20251209_235551</con:value></con:property><con:property><con:name>old_firebase</con:name><con:value>9917362878439617</con:value></con:property></con:properties></con:testCase><con:testCase id="8791b212-0b28-4f89-87ec-a9d0847a60c5" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_07_Login_GetInfor_UpdateInforFail_GetInfor" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Login" id="107521d1-6fe6-4736-99ef-3b01b7abeec1"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>e89225f9-fb5d-4132-b399-c69c08f32706</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 1" id="35903c58-687d-4647-ab6e-bff66884bdbd"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 1" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ Project (do JDBC step set trước đó)
def expectedUsername = context.expand('${#Project#username}')
def expectedEmail    = context.expand('${#Project#email}')
def expectedFullname = context.expand('${#Project#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email == expectedEmail       : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="6182644b-caf4-4318-9738-1973cd6af26a" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

// Lưu lại thông tin cũ
tc.setPropertyValue("old_username",   data.username?.toString() ?: "")
tc.setPropertyValue("old_email",      data.email?.toString() ?: "")
tc.setPropertyValue("old_fullname",   data.fullname?.toString() ?: "")
tc.setPropertyValue("old_firebase",   data.firebase_id?.toString() ?: "")

log.info "Saved old info: username=${data.username}, email=${data.email}, fullname=${data.fullname}, firebase_id=${data.firebase_id}"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Update Infor Fail (Invalid Email Format)" id="4cab4a19-2f86-4b75-9508-d757fdd2e39b"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Update Infor Fail (Invalid Email Format)" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "${#Project#username}",
      "email": "23020666",
      "fullname": "Đào Huy Hoàng",
      "password": "hoang123####",
      "firebase_id": "666666666666666sssiizzzzaa"
}</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7fbf16bb-7db4-4d99-8db8-ff5231d19e2f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case email sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case email sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field email ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List &amp;&amp; json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def firstMsg = json.errors.email[0] as String
assert firstMsg == "Enter a valid email address." :
        "Thông báo lỗi email sai. Expected 'Enter a valid email address.', got '${firstMsg}'"
</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="e33205c0-06fa-4d12-9fa5-fe12fc1511f9" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected HTTP 200 but got ${status}"

// 2. Lấy response body
def rawBody = messageExchange.response.contentAsString
assert rawBody : "Response body is empty"

// 3. Parse JSON
def json
try {
    json = new JsonSlurper().parseText(rawBody)
} catch (Exception e) {
    assert false : "Response is not valid JSON: ${e.message}\nBody: ${rawBody}"
}

// 4. Kiểm tra các field top-level
assert json.success == true : "success must be true but was: ${json.success}"
assert json.message?.toString().contains("Updated") : "message must contain 'Updated' but was: ${json.message}"

// 5. Kiểm tra data không null
assert json.data != null : "data must not be null"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 2" id="66d819d3-556c-48c1-accd-8c4a8cdea5ea"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 2" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#Project#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ Project (do JDBC step set trước đó)
def expectedUsername = context.expand('${#Project#username}')
def expectedEmail    = context.expand('${#Project#email}')
def expectedFullname = context.expand('${#Project#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email == expectedEmail       : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="7378ca09-27d7-4989-a98f-4f739ca51867" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

def oldUsername = tc.getPropertyValue("old_username")
def oldEmail    = tc.getPropertyValue("old_email")
def oldFullname = tc.getPropertyValue("old_fullname")
def oldFirebase = tc.getPropertyValue("old_firebase")

log.info "Old fullname   = ${oldFullname} | New fullname   = ${data.fullname}"
log.info "Old email      = ${oldEmail}    | New email      = ${data.email}"
log.info "Old firebase   = ${oldFirebase} | New firebase   = ${data.firebase_id}"

// Ví dụ: username giữ nguyên
assert data.username?.toString() == oldUsername : "USERNAME sau update bị đổi, không mong muốn!"

// Các field còn lại PHẢI khác (vì anh vừa update)
assert data.fullname?.toString()   != oldFullname : "FULLNAME không thay đổi sau update!"
assert data.email?.toString()      != oldEmail    : "EMAIL không thay đổi sau update!"
assert data.firebase_id?.toString() != oldFirebase : "FIREBASE_ID không thay đổi sau update!"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>old_username</con:name><con:value>u_20251207_124742_b08e02</con:value></con:property><con:property><con:name>old_email</con:name><con:value>user_20251207_165431_c50e32@example.com</con:value></con:property><con:property><con:name>old_fullname</con:name><con:value>User_20251207_165431</con:value></con:property><con:property><con:name>old_firebase</con:name><con:value>fb_20251207_165431</con:value></con:property></con:properties></con:testCase><con:properties/></con:testSuite><con:testSuite id="5e7bc0fd-54e8-419a-828c-2c74d5c13a79" name="Workflow LoadTest Testuie"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="d29a5644-49c7-43f1-a94d-829a234fc6f2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_01_SignUp_Login_CreateTopic_AddWord_GetTopic" searchProperties="true"><con:settings/><con:testStep type="groovy" name="GS_GenUserData" id="49dda040-3c84-4d38-be43-6d168aca75dd"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.security.SecureRandom

def now = new Date()
def fmt = new SimpleDateFormat("yyyyMMdd_HHmmss")
def timeStr = fmt.format(now)

// random suffix ngắn để tránh trùng
def randomSuffix = UUID.randomUUID().toString().replace("-", "").substring(0, 6)

// username: tối đa 150 ký tự, làm gọn gàng
def username = "u_${timeStr}_${randomSuffix}"   // ví dụ: u_20251206_231530_ab12cd

// email: dùng luôn username cho dễ trace
def email = "${username}@testmail.com"

// fullname: demo đơn giản
def fullname = "User ${timeStr}"

// password: random số cho đỡ trùng
def rnd = new SecureRandom()
def password = "Pass" + (100000 + rnd.nextInt(900000))  // Pass123456

// firebase_id: chuỗi 16 số ngẫu nhiên
def firebaseIdLength = 16
def firebaseId = (1..firebaseIdLength).collect { rnd.nextInt(10) }.join()

// ===== Ghi vào TestCase Properties =====
def tc = context.testCase
tc.setPropertyValue("username",    username)
tc.setPropertyValue("email",       email)
tc.setPropertyValue("fullname",    fullname)
tc.setPropertyValue("password",    password)
tc.setPropertyValue("firebase_id", firebaseId)

// Log cho dễ debug
log.info "Generated username   = ${username}"
log.info "Generated email      = ${email}"
log.info "Generated fullname   = ${fullname}"
log.info "Generated password   = ${password}"
log.info "Generated firebaseId = ${firebaseId}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Sign up" id="dc1f601e-911a-4166-ad4a-57d129a19365"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Sign up" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username": "${#TestCase#username}",
  "email":    "${#TestCase#email}",
  "fullname": "${#TestCase#fullname}",
  "password": "${#TestCase#password}",
  "firebase_id": "${#TestCase#firebase_id}"
}
</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="81a9852d-65c1-438f-a396-51d57c65f947" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
import java.time.OffsetDateTime

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer
assert status == 201 || status == 200 : "Expected HTTP 201/200 nhưng nhận được ${status}"

// ===== 2. Parse JSON =====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ===== 3. Check các field top-level =====
assert json.success == true : "Trường success phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "message phải = 'Created', hiện tại = '${json.message}'"
assert json.data != null : "Trường data bị null!"

def data = json.data

// ===== 4. Kiểm tra các field trong data =====

// id > 0
assert (data.id instanceof Number) &amp;&amp; data.id > 0 : "id phải là số dương, hiện tại = ${data.id}"

// các field string không được rỗng
assert data.username : "username trống hoặc null!"
assert data.email    : "email trống hoặc null!"
assert data.fullname : "fullname trống hoặc null!"
assert data.firebase_id : "firebase_id trống hoặc null!"
assert data.created_at  : "created_at trống hoặc null!"

// ===== 5. Không được có field password ở root hoặc trong data =====
assert !json.containsKey('password') : "Response root không được chứa field 'password'!"

if (json.data instanceof Map) {
    assert !json.data.containsKey('password') : "Response.data không được chứa field 'password'!"
}

// ===== 6. Validate format thời gian created_at (ISO-8601) =====
try {
    OffsetDateTime.parse(data.created_at as String)
} catch (Exception e) {
    assert false : "created_at không phải định dạng ISO-8601 hợp lệ: ${data.created_at}"
}</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Login" id="707d4745-7eb8-4ae5-9f15-02fb98fadcd0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Login" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{
  "username": "${#TestCase#username}",
  "password": "${#TestCase#password}"
}
</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer Token" id="abb9d02f-2600-4a38-8155-928b1b110352"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="JDBC_GetUserByUsername" id="6a08a7b2-05da-432c-a2f7-9c89a6937177"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id,
       username,
       email,
       fullname,
       firebase_id,
       created_at
FROM users_user
WHERE username = '${#TestCase#username}'
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS_SetExpectedFromDB" id="58a97b8a-42e5-4fe9-8150-b630cd685801"><con:settings/><con:config><script>import groovy.util.XmlSlurper

def jdbcStep = context.testCase.testSteps["JDBC_GetUserByUsername"]

// LẤY ĐÚNG PROPERTY!
def resultXml = jdbcStep.getPropertyValue("ResponseAsXml")

if (!resultXml) {
    assert false : "JDBC_GetUserByUsername không trả về kết quả nào!"
}

// Parse XML
def rs = new XmlSlurper().parseText(resultXml)

// Lấy row đầu tiên
def row = rs.ResultSet.Row[0]
assert row != null : "Không tìm thấy user trong DB!"

// Lấy từng cột
def id         = row.'USERS_USER.ID'.text()
def username   = row.'USERS_USER.USERNAME'.text()
def email      = row.'USERS_USER.EMAIL'.text()
def fullname   = row.'USERS_USER.FULLNAME'.text()

// Lưu expected vào Project
def tc = context.testCase
tc.setPropertyValue("user_id",  id)
tc.setPropertyValue("username_db", username)
tc.setPropertyValue("email_db",    email)
tc.setPropertyValue("fullname_db", fullname)

log.info "[Expected from DB] id=${id}, username=${username}, email=${email}, fullname=${fullname}"
</script></con:config></con:testStep><con:testStep type="groovy" name="GS Gen TopicData" id="84e5b012-6f7a-4af0-9b1e-0e0902b3e6e7"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.util.Collections

// ===== 1. Generate topic title =====
def now = new Date()
def fmt = new SimpleDateFormat("yyyyMMdd_HHmmss")
def timeStr = fmt.format(now)
def randomSuffix = UUID.randomUUID().toString().substring(0, 6)
def topicTitle = "tv_${timeStr}_${randomSuffix}"

// ===== 2. Generate random Japanese word =====
def allWords = [
    "気持ち",
    "花",
    "花火",
    "気分",
    "嬉しい",
    "悲しい",
    "安い",
    "高い",
    "面白い",
    "楽しい",
    "忙しい",
    "静か",
    "にぎやか",
    "暑い",
    "寒い",
    "新しい",
    "古い",
    "きれい",
    "便利",
    "有名"
]

// Shuffle + pick FIRST WORD as STRING
Collections.shuffle(allWords)
def topicWords = allWords[0]  

// ===== 3. Save property =====
def tc = context.testCase
tc.setPropertyValue("topic_title", topicTitle)
tc.setPropertyValue("topic_words", topicWords)

log.info "Generated topic_title = ${topicTitle}"
log.info "Generated topic_words = ${topicWords}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Create topic" id="67720188-d35d-45e1-b7fe-34222afbeb7a"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Create topic" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "title": "${#TestCase#topic_title}",
  "words": "${#TestCase#topic_words}"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="a269c5f6-bebc-4f35-92f1-513e8cc7c5f6" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// Nếu API anh trả 200 thì đổi lại 200.
assert status == 201 : "Status phải = 201 cho case tạo thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "'message' phải = 'Created', hiện tại = '${json.message}'"

// 4. (Optional) Data tồn tại
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetTopicId" id="454a4f7e-ab06-4c42-b6b4-e72f868038f0"><con:settings><con:setting id="discardResponse">false</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT t.id AS topic_id
FROM   notes_topic t
JOIN   notes_note n
       ON t.note_id = n.id
WHERE  n.user_id = ${#TestCase#user_id}
  AND  t.title    = '${#TestCase#topic_title}'
ORDER BY t.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetTopicId" id="13abd8d5-0121-49cd-ad86-95d5bff538ba"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

def jdbc = context.testCase.testSteps["JDBC GetTopicId"]
def xml  = jdbc.getPropertyValue("ResponseAsXml")

assert xml : "JDBC GetTopicId không trả về ResponseAsXml!"

def root = new XmlSlurper().parseText(xml)
def row  = root.ResultSet.Row[0]

assert row != null : "Không có Row nào trong kết quả JDBC!"

def topicId = row."NOTES_TOPIC.ID".text()
assert topicId : "Không tìm thấy NOTES_TOPIC.ID trong JDBC!"

// Ghi vào TESTCASE property
def tc = context.testCase
tc.setPropertyValue("topic_id", topicId)

log.info "=> Set TestCase.topic_id = ${topicId}"
</script></con:config></con:testStep><con:testStep type="groovy" name="Gen WordData" id="6023b9f0-dfb8-4dbe-981c-ff2b7bb9f1e1"><con:settings/><con:config><script>import java.util.Collections

// ===== 1. List từ vựng để random =====
def allWords = [
    "気持ち",   // cảm xúc
    "花",       // hoa
    "花火",     // pháo hoa
    "気分",     // tâm trạng
    "嬉しい",   // vui
    "悲しい",   // buồn
    "安い",     // rẻ
    "高い",     // đắt
    "面白い",   // thú vị
    "楽しい",   // vui vẻ
    "忙しい",   // bận rộn
    "静か",     // yên tĩnh
    "にぎやか", // náo nhiệt
    "暑い",     // nóng
    "寒い",     // lạnh
    "新しい",   // mới
    "古い",     // cũ
    "きれい",   // đẹp, sạch
    "便利",     // tiện lợi
    "有名"      // nổi tiếng
]

// Xáo trộn &amp; lấy 1 từ bất kỳ
Collections.shuffle(allWords)
def word = allWords[0]

// ===== 2. Ghi vào TestCase property add_word =====
def tc = context.testCase
tc.setPropertyValue("add_word", word)

// Log cho dễ debug
log.info "Generated add_word = ${word}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Add word" id="86769d78-f48f-45df-9255-e9b43d98c050"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Add word" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="23cb86c0-242e-4088-81a3-927f7820b6e7" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// nếu backend trả 201 thì sửa lại 201
assert status == 200 : "Status phải = 200 cho case add-word thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Words added successfully" :
    "'message' phải = 'Words added successfully', hiện tại = '${json.message}'"

// phải có field data (dù là chuỗi rỗng)
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#TestCase#add_word}"/>
  <con:entry key="topic_id" value="${#TestCase#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaId" id="d61b9ba4-bcb3-4d96-95e8-224cb6c0523e"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id AS voca_id
FROM notes_voca
WHERE word = '${#TestCase#add_word}'
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="e129a905-c84e-46ed-8e58-d1f65170db6c" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// 1. Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent
log.info "JDBC_GetVocaId Response = ${xmlText}"

// 2. Parse XML
def root = new XmlSlurper().parseText(xmlText)

// 3. Lấy dòng đầu tiên (nếu có)
def row = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC (không tìm thấy voca)"

// 4. Lấy giá trị &lt;NOTES_VOCA.ID>
def vocaId = row."NOTES_VOCA.ID".text()
assert vocaId : "Không đọc được NOTES_VOCA.ID từ JDBC result!"

// 5. Ghi vào TESTCASE property để dùng ở bước sau
def tc = context.testCase
tc.setPropertyValue("add_word_id", vocaId)

log.info "Assertion OK - voca_id = ${vocaId}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckVocaTopic" id="49ed46fc-6f78-42af-948b-2f129a3a4491"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM notes_vocatopic
WHERE topic_id = ${#TestCase#topic_id}
  AND voca_id  = ${#TestCase#add_word_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="4aece3c5-2971-4e95-b78c-27cf3cd4e5c7" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)
def cnt  = root.ResultSet.Row[0].CNT.text() as Integer

// Lấy từ TestCase (KHÔNG còn dùng Project)
def topicId = context.expand('${#TestCase#topic_id}')
def vocaId  = context.expand('${#TestCase#voca_id}')

log.info "Check mapping: topic_id=${topicId}, voca_id=${vocaId}, count=${cnt}"

// Kiểm tra có 1 dòng trong notes_vocatopic không
assert cnt == 1 : "Không tìm thấy dòng mapping trong notes_vocatopic (topic_id=${topicId}, voca_id=${vocaId})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="Get topic" id="fcaef3b5-fdca-476a-ada1-e5a13439dd03"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get topic" id="86b783fb-a66f-4c3a-8cd5-81c1b893b166" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="6f8dc7f4-30e0-40d5-9c61-195137299a5f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case get topic by id thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 1. success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

// 2. data phải là object
assert json.data instanceof Map : "'data' phải là object (Map), hiện tại = ${json.data?.getClass()}"

def topic = json.data

// 3. kiểm tra field bắt buộc
assert topic.id         != null : "Topic phải có 'id'"
assert topic.title      != null : "Topic phải có 'title'"
assert topic.vocas      != null : "Topic phải có 'vocas'"
assert topic.created_at != null : "Topic phải có 'created_at'"
assert topic.updated_at != null : "Topic phải có 'updated_at'"

// 4. kiểu dữ liệu cơ bản
assert topic.id instanceof Number  : "'id' phải là Number, hiện tại = ${topic.id?.getClass()}"
assert topic.title instanceof String : "'title' phải là String"
assert topic.vocas instanceof String : "'vocas' phải là String"

// 5. không trả về field nhạy cảm
def forbiddenKeys = ["note", "user", "voca_topics", "details"]
forbiddenKeys.each { key ->
    assert !topic.containsKey(key) : "Topic không được chứa field nhạy cảm '${key}'"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="topic_id" value="${#TestCase#topic_id}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>topic_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:loadTest id="3ac5c470-1529-4f6c-aa2c-3b8dfe8c74fc" name="LoadTest-Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="c3ca76bc-cbde-4098-9cd6-544079206059" name="LoadTest - Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>password</con:name><con:value>Pass628146</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>4513783836999416</con:value></con:property><con:property><con:name>topic_title</con:name><con:value>tv_20251209_233105_665cbe</con:value></con:property><con:property><con:name>topic_words</con:name><con:value>古い</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1Mjk4MTY1LCJpYXQiOjE3NjUyOTc4NjUsImp0aSI6ImU1YjAwNzI3MTI4ODQ3ZTNiNjI0MWMyOTNlYTE3NTQzIiwidXNlcl9pZCI6IjY5In0._g4aJDfAoaa8WBjhnihWfRveR0Cc5nkOzG9mvxRdpxg</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2NTM4NDI2NSwiaWF0IjoxNzY1Mjk3ODY1LCJqdGkiOiI2MzEwMzdhZDZjMDM0YjMwYmE5MjdkY2E4M2QzMjdmNiIsInVzZXJfaWQiOiI2OSJ9.gwJjtav9IXMApGziRKGuHoDg8k2A5F10BUtJBWTDwe0</con:value></con:property><con:property><con:name>user_id</con:name><con:value>69</con:value></con:property><con:property><con:name>username_db</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email_db</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname_db</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>3877</con:value></con:property><con:property><con:name>add_word</con:name><con:value>寒い</con:value></con:property><con:property><con:name>add_word_id</con:name><con:value>45</con:value></con:property></con:properties></con:testCase><con:testCase id="8593e3cd-faff-4d29-acae-3f198d5b7664" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_02_Login_CreateTopic_AddWord_DeleteWord" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Login" id="40e97247-a311-40f4-8f0e-6199bff76f1c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Login" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{
  "username": "${#TestCase#username}",
  "password": "${#TestCase#password}"
}
</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer Token" id="a649e709-b9e0-433d-baeb-8ec55fdca777"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="JDBC_GetUserByUsername" id="ab75ab92-be51-4311-a1b4-e3f365693b63"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id,
       username,
       email,
       fullname,
       firebase_id,
       created_at
FROM users_user
WHERE username = '${#TestCase#username}'
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS_SetExpectedFromDB" id="78c1537b-04ae-4c04-b39d-43fbfdd28ef2"><con:settings/><con:config><script>import groovy.util.XmlSlurper

def jdbcStep = context.testCase.testSteps["JDBC_GetUserByUsername"]

// LẤY ĐÚNG PROPERTY!
def resultXml = jdbcStep.getPropertyValue("ResponseAsXml")

if (!resultXml) {
    assert false : "JDBC_GetUserByUsername không trả về kết quả nào!"
}

// Parse XML
def rs = new XmlSlurper().parseText(resultXml)

// Lấy row đầu tiên
def row = rs.ResultSet.Row[0]
assert row != null : "Không tìm thấy user trong DB!"

// Lấy từng cột
def id         = row.'USERS_USER.ID'.text()
def username   = row.'USERS_USER.USERNAME'.text()
def email      = row.'USERS_USER.EMAIL'.text()
def fullname   = row.'USERS_USER.FULLNAME'.text()

// Lưu expected vào Project
def tc = context.testCase
tc.setPropertyValue("user_id",  id)
tc.setPropertyValue("username_db", username)
tc.setPropertyValue("email_db",    email)
tc.setPropertyValue("fullname_db", fullname)

log.info "[Expected from DB] id=${id}, username=${username}, email=${email}, fullname=${fullname}"
</script></con:config></con:testStep><con:testStep type="groovy" name="GS Gen TopicData" id="4e486ef9-171c-43ce-b542-8953f3ab2550"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.util.Collections

// ===== 1. Generate topic title =====
def now = new Date()
def fmt = new SimpleDateFormat("yyyyMMdd_HHmmss")
def timeStr = fmt.format(now)
def randomSuffix = UUID.randomUUID().toString().substring(0, 6)
def topicTitle = "tv_${timeStr}_${randomSuffix}"

// ===== 2. Generate random Japanese word =====
def allWords = [
    "気持ち",
    "花",
    "花火",
    "気分",
    "嬉しい",
    "悲しい",
    "安い",
    "高い",
    "面白い",
    "楽しい",
    "忙しい",
    "静か",
    "にぎやか",
    "暑い",
    "寒い",
    "新しい",
    "古い",
    "きれい",
    "便利",
    "有名"
]

// Shuffle + pick FIRST WORD as STRING
Collections.shuffle(allWords)
def topicWords = allWords[0]  

// ===== 3. Save property =====
def tc = context.testCase
tc.setPropertyValue("topic_title", topicTitle)
tc.setPropertyValue("topic_words", topicWords)

log.info "Generated topic_title = ${topicTitle}"
log.info "Generated topic_words = ${topicWords}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Create topic" id="7019b147-cec0-4dc8-bae4-b837a5600166"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Create topic" id="3fd2a497-2a5e-4626-b05d-fa9561c14e56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "title": "${#TestCase#topic_title}",
  "words": "${#TestCase#topic_words}"
}</con:request><con:originalUri>http://localhost/api/topics/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="a269c5f6-bebc-4f35-92f1-513e8cc7c5f6" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// Nếu API anh trả 200 thì đổi lại 200.
assert status == 201 : "Status phải = 201 cho case tạo thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 3. Kiểm tra success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "'message' phải = 'Created', hiện tại = '${json.message}'"

// 4. (Optional) Data tồn tại
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetTopicId" id="5830ac7f-cd4f-4bcf-bd05-06a0b04f339d"><con:settings><con:setting id="discardResponse">false</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT t.id AS topic_id
FROM   notes_topic t
JOIN   notes_note n
       ON t.note_id = n.id
WHERE  n.user_id = ${#TestCase#user_id}
  AND  t.title    = '${#TestCase#topic_title}'
ORDER BY t.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetTopicId" id="c3c6b5e2-259a-4519-bf21-6981c86274ec"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

def jdbc = context.testCase.testSteps["JDBC GetTopicId"]
def xml  = jdbc.getPropertyValue("ResponseAsXml")

assert xml : "JDBC GetTopicId không trả về ResponseAsXml!"

def root = new XmlSlurper().parseText(xml)
def row  = root.ResultSet.Row[0]

assert row != null : "Không có Row nào trong kết quả JDBC!"

def topicId = row."NOTES_TOPIC.ID".text()
assert topicId : "Không tìm thấy NOTES_TOPIC.ID trong JDBC!"

// Ghi vào TESTCASE property
def tc = context.testCase
tc.setPropertyValue("topic_id", topicId)

log.info "=> Set TestCase.topic_id = ${topicId}"
</script></con:config></con:testStep><con:testStep type="groovy" name="Gen WordData" id="72805055-c3c4-47a8-a676-39a067bf8c3b"><con:settings/><con:config><script>import java.util.Collections

// ===== 1. List từ vựng để random =====
def allWords = [
    "気持ち",   // cảm xúc
    "花",       // hoa
    "花火",     // pháo hoa
    "気分",     // tâm trạng
    "嬉しい",   // vui
    "悲しい",   // buồn
    "安い",     // rẻ
    "高い",     // đắt
    "面白い",   // thú vị
    "楽しい",   // vui vẻ
    "忙しい",   // bận rộn
    "静か",     // yên tĩnh
    "にぎやか", // náo nhiệt
    "暑い",     // nóng
    "寒い",     // lạnh
    "新しい",   // mới
    "古い",     // cũ
    "きれい",   // đẹp, sạch
    "便利",     // tiện lợi
    "有名"      // nổi tiếng
]

// Xáo trộn &amp; lấy 1 từ bất kỳ
Collections.shuffle(allWords)
def word = allWords[0]

// ===== 2. Ghi vào TestCase property add_word =====
def tc = context.testCase
tc.setPropertyValue("add_word", word)

// Log cho dễ debug
log.info "Generated add_word = ${word}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Add word" id="22724f2b-6c08-442d-b770-e0dce91c155e"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Add word" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="23cb86c0-242e-4088-81a3-927f7820b6e7" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// nếu backend trả 201 thì sửa lại 201
assert status == 200 : "Status phải = 200 cho case add-word thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Words added successfully" :
    "'message' phải = 'Words added successfully', hiện tại = '${json.message}'"

// phải có field data (dù là chuỗi rỗng)
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#TestCase#add_word}"/>
  <con:entry key="topic_id" value="${#TestCase#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaId" id="7ed4f6d3-3262-45e6-8600-31145109bd29"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id AS voca_id
FROM notes_voca
WHERE word = '${#TestCase#add_word}'
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="e129a905-c84e-46ed-8e58-d1f65170db6c" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// 1. Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent
log.info "JDBC_GetVocaId Response = ${xmlText}"

// 2. Parse XML
def root = new XmlSlurper().parseText(xmlText)

// 3. Lấy dòng đầu tiên (nếu có)
def row = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC (không tìm thấy voca)"

// 4. Lấy giá trị &lt;NOTES_VOCA.ID>
def vocaId = row."NOTES_VOCA.ID".text()
assert vocaId : "Không đọc được NOTES_VOCA.ID từ JDBC result!"

// 5. Ghi vào TESTCASE property để dùng ở bước sau
def tc = context.testCase
tc.setPropertyValue("add_word_id", vocaId)

log.info "Assertion OK - voca_id = ${vocaId}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckVocaTopic" id="5fec1926-45c9-4959-a210-456a5edaa3f7"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM notes_vocatopic
WHERE topic_id = ${#TestCase#topic_id}
  AND voca_id  = ${#TestCase#add_word_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="4aece3c5-2971-4e95-b78c-27cf3cd4e5c7" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)
def cnt  = root.ResultSet.Row[0].CNT.text() as Integer

// Lấy từ TestCase (KHÔNG còn dùng Project)
def topicId = context.expand('${#TestCase#topic_id}')
def vocaId  = context.expand('${#TestCase#voca_id}')

log.info "Check mapping: topic_id=${topicId}, voca_id=${vocaId}, count=${cnt}"

// Kiểm tra có 1 dòng trong notes_vocatopic không
assert cnt == 1 : "Không tìm thấy dòng mapping trong notes_vocatopic (topic_id=${topicId}, voca_id=${vocaId})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaIds" id="c5dd2972-ff7e-4962-a235-c85207c68d2e"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT vt.id  AS voca_topic_id,
       vd.id  AS voca_detail_id
FROM   notes_vocatopic vt
JOIN   notes_voca v
       ON vt.voca_id = v.id
JOIN   notes_vocadetail vd
       ON vd.voca_topic_id = vt.id
WHERE  vt.topic_id = ${#TestCase#topic_id}
  AND  v.word      = '${#TestCase#add_word}'
ORDER BY vd.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetVocaIds" id="fb05fa31-6e9b-4b41-9332-2b5d67c4c7fc"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

// Lấy step JDBC – TÊN PHẢI TRÙNG 100% VỚI STEP CỦA ANH
def jdbc = context.testCase.testSteps["JDBC GetVocaIds"]

// Lấy XML kết quả
def xmlText = jdbc.getPropertyValue("ResponseAsXml")
log.info "JDBC_GetVocaIds ResponseAsXml = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)
def row  = root.ResultSet.Row[0]

// Lấy 2 ID từ tag có dấu chấm
def vocaTopicId  = row."NOTES_VOCATOPIC.ID".text()
def vocaDetailId = row."NOTES_VOCADETAIL.ID".text()

assert vocaTopicId  : "Không lấy được NOTES_VOCATOPIC.ID!"
assert vocaDetailId : "Không lấy được NOTES_VOCADETAIL.ID!"

// ===== Gán vào TestCase properties  =====
def tc = context.testCase

// đảm bảo property tồn tại rồi mới set cho chắc
def putProp = { String name, String value ->
    if (!tc.hasProperty(name)) {
        tc.addProperty(name)
    }
    tc.setPropertyValue(name, value)
}

putProp("vocal_topic_id",  vocaTopicId)
putProp("vocal_detail_id", vocaDetailId)

log.info "Set TestCase#vocal_topic_id  = ${vocaTopicId}"
log.info "Set TestCase#vocal_detail_id = ${vocaDetailId}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Del word" id="883e1ae0-c5e7-47f9-b95c-56b500ba8f48"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Del word" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="b61ca1b8-2714-4776-98bd-b650cba7f63f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseHeaders['#status#'][0]
assert status.contains('200') : "Expected 200, got: ${status}"

def raw = messageExchange.response.responseContent
assert raw : "Empty response"

def json = new JsonSlurper().parseText(raw)

assert json.success == true : "success != true : ${json.success}"
assert json.message == "Deleted" : "message != 'Deleted' : ${json.message}"
assert json.data instanceof Map : "data must be object, got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#TestCase#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#TestCase#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#TestCase#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckDeleted" id="586526e2-8792-477e-b668-c93a81c8fdc2"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM   notes_vocadetail vd
JOIN   notes_vocatopic vt ON vd.voca_topic_id = vt.id
WHERE  vd.id = ${#TestCase#vocal_detail_id}
  AND  vt.id = ${#TestCase#vocal_topic_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="056ff655-d8d0-47fe-9268-3195c34d5e33" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// JDBC trả về XML trong messageExchange.responseContent
def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)

// Lấy COUNT(*) alias CNT
def row = root.ResultSet.Row[0]
def cnt = row.CNT.text() as Integer   // &lt;CNT>0&lt;/CNT>

log.info "DB count for deleted voca_detail = ${cnt}"

// Mong muốn: không còn bản ghi nào
assert cnt == 0 : "Expected 0 record after delete, but found ${cnt} in DB"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:loadTest id="9ba3b267-ef5f-4d02-acda-5fe2bdeb1fa4" name="LoadTest-Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="5e988ee2-4bb3-456c-921a-2b8947842fdf" name="LoadTest - Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>password</con:name><con:value>Pass628146</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>4513783836999416</con:value></con:property><con:property><con:name>topic_title</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>topic_words</con:name><con:value>花</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1MzAyMzUyLCJpYXQiOjE3NjUzMDIwNTIsImp0aSI6IjY0ZTUzMzMyZWI2MzQ1YmI4YmI1MzVkOGM0OGE5YWQ0IiwidXNlcl9pZCI6IjY5In0.2cEkCeVSOp6MzKqQG6MB1e2Es6EInt4DddeNOeAFzmc</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2NTM4ODQ1MiwiaWF0IjoxNzY1MzAyMDUyLCJqdGkiOiIzNTgxZjdhZTk4MWQ0OGVhOWIwOTA4NWEwY2E4NWViOCIsInVzZXJfaWQiOiI2OSJ9.fRhPWjEZ7fAyjKF7DKDAPusMdMsLUCpqfKU3INj8vK8</con:value></con:property><con:property><con:name>user_id</con:name><con:value>69</con:value></con:property><con:property><con:name>username_db</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email_db</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname_db</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>4694</con:value></con:property><con:property><con:name>add_word</con:name><con:value>古い</con:value></con:property><con:property><con:name>add_word_id</con:name><con:value>47</con:value></con:property><con:property><con:name>vocal_topic_id</con:name><con:value>5517</con:value></con:property><con:property><con:name>vocal_detail_id</con:name><con:value>6437</con:value></con:property></con:properties></con:testCase><con:testCase id="73846e82-ea1a-4efd-926e-5a8e9d1a4cc6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_03_Login_SearchTopic_AddWord_DeleteWord" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Login" id="1bc74381-b5b5-43bc-bdb9-dac158dae105"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Login" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{
  "username": "${#TestCase#username}",
  "password": "${#TestCase#password}"
}
</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer Token" id="ee9adaa3-7129-4404-8228-a6525a67c936"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="JDBC_GetUserByUsername" id="6562e6d7-1638-48c4-8f12-d5d6fcc7efa4"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id,
       username,
       email,
       fullname,
       firebase_id,
       created_at
FROM users_user
WHERE username = '${#TestCase#username}'
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS_SetExpectedFromDB" id="8657f076-6065-48a9-8d4f-b73fd6cf3e83"><con:settings/><con:config><script>import groovy.util.XmlSlurper

def jdbcStep = context.testCase.testSteps["JDBC_GetUserByUsername"]

// LẤY ĐÚNG PROPERTY!
def resultXml = jdbcStep.getPropertyValue("ResponseAsXml")

if (!resultXml) {
    assert false : "JDBC_GetUserByUsername không trả về kết quả nào!"
}

// Parse XML
def rs = new XmlSlurper().parseText(resultXml)

// Lấy row đầu tiên
def row = rs.ResultSet.Row[0]
assert row != null : "Không tìm thấy user trong DB!"

// Lấy từng cột
def id         = row.'USERS_USER.ID'.text()
def username   = row.'USERS_USER.USERNAME'.text()
def email      = row.'USERS_USER.EMAIL'.text()
def fullname   = row.'USERS_USER.FULLNAME'.text()

// Lưu expected vào Project
def tc = context.testCase
tc.setPropertyValue("user_id",  id)
tc.setPropertyValue("username_db", username)
tc.setPropertyValue("email_db",    email)
tc.setPropertyValue("fullname_db", fullname)

log.info "[Expected from DB] id=${id}, username=${username}, email=${email}, fullname=${fullname}"
</script></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetRandomTopicTitle" id="1bb565c8-fc27-4290-9e29-f3670eacc8b6"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT t.title AS topic_title
FROM   notes_topic t
JOIN   notes_note n ON t.note_id = n.id
WHERE  n.user_id = ${#TestCase#user_id}
ORDER BY RAND()
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="6f87f5a7-243a-486f-bda4-12dd88ff0e3d" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent       // nếu là Script Assertion
// nếu là Groovy Step sau JDBC thì dùng:
// def xmlText = context.testCase.testSteps["JDBC GetTopicTitle"].getPropertyValue("ResponseAsXml")

log.info "JDBC_GetTopicTitle Response = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)
def row  = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC!"

// Lấy giá trị &lt;NOTES_TOPIC.TITLE>
def topicTitle = row."NOTES_TOPIC.TITLE".text()
assert topicTitle : "Không đọc được NOTES_TOPIC.TITLE từ JDBC result!"

// Gán vào Project property để dùng cho Search Topic
def project = context.testCase.testSuite.project
project.setPropertyValue("search_text", topicTitle)
project.setPropertyValue("topic_title", topicTitle)

log.info "Set Project#search_text = ${topicTitle}"
log.info "Set Project#topic_title = ${topicTitle}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetSearchText" id="c8bfa874-5073-4c31-a3f4-864cff72f638"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

// Lấy step JDBC
def jdbc = context.testCase.testSteps["JDBC GetRandomTopicTitle"]
def xml  = jdbc.getPropertyValue("ResponseAsXml")
log.info "RandomTopicTitle XML = ${xml}"

// Parse XML
def root = new XmlSlurper().parseText(xml)
def row  = root.ResultSet.Row[0]
assert row != null : "Không tìm thấy topic nào trong DB cho user này!"

// Lấy giá trị &lt;NOTES_TOPIC.TITLE>
def topicTitle = row."NOTES_TOPIC.TITLE".text()
assert topicTitle : "Không đọc được NOTES_TOPIC.TITLE!"

// ===== Gán vào TestCase properties để dùng cho Search Topic / log =====
def tc = context.testCase

def putProp = { String name, String value ->
    if (!tc.hasProperty(name)) {
        tc.addProperty(name)
    }
    tc.setPropertyValue(name, value)
}

putProp("search_text", topicTitle)
putProp("topic_title", topicTitle)

log.info "Picked topic_title for search = ${topicTitle}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Search topic" id="d929f4ef-481c-418c-a389-6122c65f596c"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topics/search/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Search topic" id="829f4a89-4e5d-464a-870a-085b5e36baf1" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topics/search/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ff4fa8bf-4796-4f5d-9af3-67ca2676c69a" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Status phải = 200 cho case search thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// 1. success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Fetched" : "'message' phải = 'Fetched', hiện tại = '${json.message}'"

// 2. data phải là list, có ít nhất 1 kết quả
assert json.data instanceof List : "'data' phải là list, hiện tại = ${json.data?.getClass()}"
assert json.data.size() > 0 : "Search q='tv' phải trả về ít nhất 1 topic, hiện tại size = ${json.data.size()}"

// 3. kiểm tra structure + title phải chứa 'tv'
def query = "tv".toLowerCase()

json.data.eachWithIndex { topic, idx ->
    assert topic.id         != null : "Topic [${idx}] phải có 'id'"
    assert topic.title      != null : "Topic [${idx}] phải có 'title'"
    assert topic.vocas      != null : "Topic [${idx}] phải có 'vocas'"
    assert topic.created_at != null : "Topic [${idx}] phải có 'created_at'"
    assert topic.updated_at != null : "Topic [${idx}] phải có 'updated_at'"

    // kiểu dữ liệu cơ bản
    assert topic.id instanceof Number : "Topic [${idx}].id phải là Number, hiện tại = ${topic.id?.getClass()}"
    assert topic.title instanceof String : "Topic [${idx}].title phải là String"
    assert topic.vocas instanceof String : "Topic [${idx}].vocas phải là String"

    // title phải chứa query 'tv' (case-insensitive)
    def titleStr = topic.title.toString().toLowerCase()
    assert titleStr.contains(query) :
        "Topic [${idx}].title = '${topic.title}' không chứa query '${query}'"

    // không có field nhạy cảm
    def forbiddenKeys = ["note", "user", "voca_topics", "details"]
    forbiddenKeys.each { key ->
        assert !topic.containsKey(key) : "Topic [${idx}] không được chứa field nhạy cảm '${key}'"
    }
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="q" value="${#TestCase#search_text}" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>q</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Gen WordData" id="7ea7adb8-affd-4898-a08b-c6a672abda13"><con:settings/><con:config><script>import java.util.Collections

// ===== 1. List từ vựng để random =====
def allWords = [
    "気持ち",   // cảm xúc
    "花",       // hoa
    "花火",     // pháo hoa
    "気分",     // tâm trạng
    "嬉しい",   // vui
    "悲しい",   // buồn
    "安い",     // rẻ
    "高い",     // đắt
    "面白い",   // thú vị
    "楽しい",   // vui vẻ
    "忙しい",   // bận rộn
    "静か",     // yên tĩnh
    "にぎやか", // náo nhiệt
    "暑い",     // nóng
    "寒い",     // lạnh
    "新しい",   // mới
    "古い",     // cũ
    "きれい",   // đẹp, sạch
    "便利",     // tiện lợi
    "有名"      // nổi tiếng
]

// Xáo trộn &amp; lấy 1 từ bất kỳ
Collections.shuffle(allWords)
def word = allWords[0]

// ===== 2. Ghi vào TestCase property add_word =====
def tc = context.testCase
tc.setPropertyValue("add_word", word)

// Log cho dễ debug
log.info "Generated add_word = ${word}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Add word" id="15dad6d6-feb9-44c0-8ab2-c15a81071099"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/add-word/{add_word}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Add word" id="a1358df6-7369-47ce-9b7e-c03c84cefd3c" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic/44/add-word/tata/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="23cb86c0-242e-4088-81a3-927f7820b6e7" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

assert messageExchange.response, "Không có response trả về"

def status = messageExchange.responseStatusCode as Integer
// nếu backend trả 201 thì sửa lại 201
assert status == 200 : "Status phải = 200 cho case add-word thành công, hiện tại = ${status}"

def body = messageExchange.responseContent
assert body : "Response body rỗng"

def json
try {
    json = new JsonSlurper().parseText(body)
} catch (e) {
    assert false : "Response không phải JSON hợp lệ: ${e.message}\nBody: ${body}"
}

// success + message
assert json.success == true : "'success' phải = true, hiện tại = ${json.success}"
assert json.message == "Words added successfully" :
    "'message' phải = 'Words added successfully', hiện tại = '${json.message}'"

// phải có field data (dù là chuỗi rỗng)
assert json.containsKey("data") : "Response phải có field 'data'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="add_word" value="${#TestCase#add_word}"/>
  <con:entry key="topic_id" value="${#TestCase#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>add_word</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaId" id="fc515cfd-3372-4ea5-a286-eb94b2e9e567"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id AS voca_id
FROM notes_voca
WHERE word = '${#TestCase#add_word}'
LIMIT 1;
</con:query><con:assertion type="GroovyScriptAssertion" id="e129a905-c84e-46ed-8e58-d1f65170db6c" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// 1. Lấy XML JDBC trả về
def xmlText = messageExchange.responseContent
log.info "JDBC_GetVocaId Response = ${xmlText}"

// 2. Parse XML
def root = new XmlSlurper().parseText(xmlText)

// 3. Lấy dòng đầu tiên (nếu có)
def row = root.ResultSet.Row[0]
assert row != null : "Không có dòng nào trong kết quả JDBC (không tìm thấy voca)"

// 4. Lấy giá trị &lt;NOTES_VOCA.ID>
def vocaId = row."NOTES_VOCA.ID".text()
assert vocaId : "Không đọc được NOTES_VOCA.ID từ JDBC result!"

// 5. Ghi vào TESTCASE property để dùng ở bước sau
def tc = context.testCase
tc.setPropertyValue("add_word_id", vocaId)

log.info "Assertion OK - voca_id = ${vocaId}"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckVocaTopic" id="db9894e2-e6e6-4f84-8099-e6525cdc1291"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM notes_vocatopic
WHERE topic_id = ${#TestCase#topic_id}
  AND voca_id  = ${#TestCase#add_word_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="4aece3c5-2971-4e95-b78c-27cf3cd4e5c7" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)
def cnt  = root.ResultSet.Row[0].CNT.text() as Integer

// Lấy từ TestCase (KHÔNG còn dùng Project)
def topicId = context.expand('${#TestCase#topic_id}')
def vocaId  = context.expand('${#TestCase#voca_id}')

log.info "Check mapping: topic_id=${topicId}, voca_id=${vocaId}, count=${cnt}"

// Kiểm tra có 1 dòng trong notes_vocatopic không
assert cnt == 1 : "Không tìm thấy dòng mapping trong notes_vocatopic (topic_id=${topicId}, voca_id=${vocaId})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="JDBC GetVocaIds" id="f6bc2107-1b40-4905-9a26-e786925a0bc1"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT vt.id  AS voca_topic_id,
       vd.id  AS voca_detail_id
FROM   notes_vocatopic vt
JOIN   notes_voca v
       ON vt.voca_id = v.id
JOIN   notes_vocadetail vd
       ON vd.voca_topic_id = vt.id
WHERE  vt.topic_id = ${#TestCase#topic_id}
  AND  v.word      = '${#TestCase#add_word}'
ORDER BY vd.id DESC
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS SetVocaIds" id="804d6154-2663-41c1-b027-7bc355806faf"><con:settings/><con:config><script>import groovy.xml.XmlSlurper

// Lấy step JDBC – TÊN PHẢI TRÙNG 100% VỚI STEP CỦA ANH
def jdbc = context.testCase.testSteps["JDBC GetVocaIds"]

// Lấy XML kết quả
def xmlText = jdbc.getPropertyValue("ResponseAsXml")
log.info "JDBC GetVocaIds ResponseAsXml = ${xmlText}"

// Parse XML
def root = new XmlSlurper().parseText(xmlText)
def row  = root.ResultSet.Row[0]

// Lấy 2 ID từ tag có dấu chấm
def vocaTopicId  = row."NOTES_VOCATOPIC.ID".text()
def vocaDetailId = row."NOTES_VOCADETAIL.ID".text()

assert vocaTopicId  : "Không lấy được NOTES_VOCATOPIC.ID!"
assert vocaDetailId : "Không lấy được NOTES_VOCADETAIL.ID!"

// ===== Gán vào TestCase properties  =====
def tc = context.testCase

// đảm bảo property tồn tại rồi mới set cho chắc
def putProp = { String name, String value ->
    if (!tc.hasProperty(name)) {
        tc.addProperty(name)
    }
    tc.setPropertyValue(name, value)
}

putProp("vocal_topic_id",  vocaTopicId)
putProp("vocal_detail_id", vocaDetailId)

log.info "Set TestCase#vocal_topic_id  = ${vocaTopicId}"
log.info "Set TestCase#vocal_detail_id = ${vocaDetailId}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Del word" id="bdf2c434-1785-47d0-b05e-8f1674d9368a"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/topic/{topic_id}/delete-word/{vocal_topic_id}/{vocal_detail_id}/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Del word" id="d73acd70-4e91-4e83-af99-633e1ae78d94" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/topic//delete-word///</con:originalUri><con:assertion type="GroovyScriptAssertion" id="b61ca1b8-2714-4776-98bd-b650cba7f63f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def status = messageExchange.responseHeaders['#status#'][0]
assert status.contains('200') : "Expected 200, got: ${status}"

def raw = messageExchange.response.responseContent
assert raw : "Empty response"

def json = new JsonSlurper().parseText(raw)

assert json.success == true : "success != true : ${json.success}"
assert json.message == "Deleted" : "message != 'Deleted' : ${json.message}"
assert json.data instanceof Map : "data must be object, got: ${json.data?.getClass()}"
assert json.data.isEmpty() : "data must be {} but got: ${json.data}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="vocal_topic_id" value="${#TestCase#vocal_topic_id}"/>
  <con:entry key="vocal_detail_id" value="${#TestCase#vocal_detail_id}"/>
  <con:entry key="topic_id" value="${#TestCase#topic_id}"/>
</con:parameters><con:parameterOrder><con:entry>topic_id</con:entry><con:entry>vocal_topic_id</con:entry><con:entry>vocal_detail_id</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC CheckDeleted" id="449611f9-b544-416c-ab32-bec7109ed57c"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS cnt
FROM   notes_vocadetail vd
JOIN   notes_vocatopic vt ON vd.voca_topic_id = vt.id
WHERE  vd.id = ${#TestCase#vocal_detail_id}
  AND  vt.id = ${#TestCase#vocal_topic_id};
</con:query><con:assertion type="GroovyScriptAssertion" id="056ff655-d8d0-47fe-9268-3195c34d5e33" name="Script Assertion"><con:configuration><scriptText>import groovy.xml.XmlSlurper

// JDBC trả về XML trong messageExchange.responseContent
def xml  = messageExchange.responseContent
def root = new XmlSlurper().parseText(xml)

// Lấy COUNT(*) alias CNT
def row = root.ResultSet.Row[0]
def cnt = row.CNT.text() as Integer   // &lt;CNT>0&lt;/CNT>

log.info "DB count for deleted voca_detail = ${cnt}"

// Mong muốn: không còn bản ghi nào
assert cnt == 0 : "Expected 0 record after delete, but found ${cnt} in DB"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:loadTest id="a135700a-76b1-4030-bde2-21fd37eafe52" name="LoadTest-Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="23b6c620-871a-4cf5-9e86-fcc70969027f" name="LoadTest - Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>password</con:name><con:value>Pass628146</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>4513783836999416</con:value></con:property><con:property><con:name>topic_title</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>topic_words</con:name><con:value>花</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1MzAyODU3LCJpYXQiOjE3NjUzMDI1NTcsImp0aSI6ImIwYjQ0Y2YzYjkzMzQwODg4YTYwZGJhNzZmNGZhNTAwIiwidXNlcl9pZCI6IjY5In0.YvNVL0tpEekT7qXH4BJnSebvATQ_VTaAKVY1BxH903Y</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2NTM4ODk1NywiaWF0IjoxNzY1MzAyNTU3LCJqdGkiOiIyYzQxNTExODZjMjA0M2Q1YTE4ZjcxZjBjOGE2ZjY5MyIsInVzZXJfaWQiOiI2OSJ9.3ncSniMN7N6uS5Tj4UsPEazaHiaXkH3h2c9HwK0nO08</con:value></con:property><con:property><con:name>user_id</con:name><con:value>69</con:value></con:property><con:property><con:name>username_db</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email_db</con:name><con:value>u_20251209_233104_4b2049@testmail.com</con:value></con:property><con:property><con:name>fullname_db</con:name><con:value>User 20251209_233104</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>4694</con:value></con:property><con:property><con:name>add_word</con:name><con:value>花火</con:value></con:property><con:property><con:name>add_word_id</con:name><con:value>16</con:value></con:property><con:property><con:name>vocal_topic_id</con:name><con:value>5519</con:value></con:property><con:property><con:name>vocal_detail_id</con:name><con:value>6438</con:value></con:property><con:property><con:name>search_text</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property></con:properties></con:testCase><con:testCase id="ce688104-8846-4840-8d51-3de653588e1f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC_FLOW_06_Login_GetInfor_UpdateInfor_GetInfor" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="Login" id="a8da4bfd-113e-4550-940b-7306cff3bdad"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Login" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{
  "username": "${#TestCase#username}",
  "password": "${#TestCase#password}"
}
</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer Token" id="6887d478-1f26-40a1-b031-08e6d57a867a"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfers (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Login</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#TestCase#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="JDBC_GetUserByUsername" id="4384d5b7-1cf5-4e16-b6a6-f90a3ad74737"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT id,
       username,
       email,
       fullname,
       firebase_id,
       created_at
FROM users_user
WHERE username = '${#TestCase#username}'
LIMIT 1;
</con:query><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="GS_SetExpectedFromDB" id="2667af12-0a6f-475a-aace-afde9dfb0861"><con:settings/><con:config><script>import groovy.util.XmlSlurper

def jdbcStep = context.testCase.testSteps["JDBC_GetUserByUsername"]

// LẤY ĐÚNG PROPERTY!
def resultXml = jdbcStep.getPropertyValue("ResponseAsXml")

if (!resultXml) {
    assert false : "JDBC_GetUserByUsername không trả về kết quả nào!"
}

// Parse XML
def rs = new XmlSlurper().parseText(resultXml)

// Lấy row đầu tiên
def row = rs.ResultSet.Row[0]
assert row != null : "Không tìm thấy user trong DB!"

// Lấy từng cột
def id         = row.'USERS_USER.ID'.text()
def username   = row.'USERS_USER.USERNAME'.text()
def email      = row.'USERS_USER.EMAIL'.text()
def fullname   = row.'USERS_USER.FULLNAME'.text()

// Lưu expected vào Project
def tc = context.testCase
tc.setPropertyValue("user_id",  id)
tc.setPropertyValue("username_db", username)
tc.setPropertyValue("email_db",    email)
tc.setPropertyValue("fullname_db", fullname)

log.info "[Expected from DB] id=${id}, username=${username}, email=${email}, fullname=${fullname}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 1" id="17729bf6-7162-4279-b8d7-b6588832e9e0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 1" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ TestCase (do JDBC step / Groovy set trước đó)
def expectedUsername = context.expand('${#TestCase#username}')
def expectedEmail    = context.expand('${#TestCase#email}')
def expectedFullname = context.expand('${#TestCase#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email    == expectedEmail    : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}
</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="6182644b-caf4-4318-9738-1973cd6af26a" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

// Lưu lại thông tin cũ
tc.setPropertyValue("old_username",   data.username?.toString() ?: "")
tc.setPropertyValue("old_email",      data.email?.toString() ?: "")
tc.setPropertyValue("old_fullname",   data.fullname?.toString() ?: "")
tc.setPropertyValue("old_firebase",   data.firebase_id?.toString() ?: "")

log.info "Saved old info: username=${data.username}, email=${data.email}, fullname=${data.fullname}, firebase_id=${data.firebase_id}"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GS_GenUpdateMeData" id="8a7f01b5-33fe-4e4e-828e-0471d2ce2899"><con:settings/><con:config><script>import java.text.SimpleDateFormat
import java.util.UUID
import java.security.SecureRandom

// Lấy username/password hiện tại từ TESTCASE (do Sign up / Login set)
def tc = context.testCase
def username = tc.getPropertyValue("username")
def oldPass  = tc.getPropertyValue("password")

assert username : "TestCase#username đang rỗng – phải chạy Sign up/Login trước!"
assert oldPass  : "TestCase#password đang rỗng – phải chạy Sign up/Login trước!"

// Sinh dữ liệu mới
def timeStr = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date())
def randomSuffix = UUID.randomUUID().toString().replace("-", "").substring(0, 6)

def newEmail    = "user_${timeStr}_${randomSuffix}@example.com"
def newFullname = "User_${timeStr}"
def newFirebase = "fb_${timeStr}"

// 🔐 Sinh mật khẩu mới
def rnd = new SecureRandom()
def newPass = "Pass" + (100000 + rnd.nextInt(900000))  // VD: Pass123456

// Ghi vào TestCase
tc.setPropertyValue("upd_username",      username)   // username giữ nguyên
tc.setPropertyValue("upd_old_password",  oldPass)    // để debug nếu cần
tc.setPropertyValue("upd_new_password",  newPass)
tc.setPropertyValue("upd_email",         newEmail)
tc.setPropertyValue("upd_fullname",      newFullname)
tc.setPropertyValue("upd_firebase",      newFirebase)

log.info "UpdateMe username        = ${username}"
log.info "UpdateMe old_password    = ${oldPass}"
log.info "UpdateMe NEW password    = ${newPass}"
log.info "UpdateMe new_email       = ${newEmail}"
log.info "UpdateMe new_fullname    = ${newFullname}"
log.info "UpdateMe new_firebase    = ${newFirebase}"
</script></con:config></con:testStep><con:testStep type="restrequest" name="Update infor" id="842de935-5197-4316-af60-44cfe3dc1ab0"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Update infor" id="cfccf2e1-70ff-4b4f-921b-280a4fc0e58e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
  "username":   "${#TestCase#upd_username}",
  "email":      "${#TestCase#upd_email}",
  "fullname":   "${#TestCase#upd_fullname}",
  "password":   "${#TestCase#upd_new_password}",
  "firebase_id": "${#TestCase#upd_firebase}"
}
</con:request><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="e88ff26e-24c2-4304-b8e7-ce7e95ab3aa9" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. Kiểm tra HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected HTTP 200 but got ${status}"

// 2. Lấy response body
def rawBody = messageExchange.response.contentAsString
assert rawBody : "Response body is empty"

// 3. Parse JSON
def json
try {
    json = new JsonSlurper().parseText(rawBody)
} catch (Exception e) {
    assert false : "Response is not valid JSON: ${e.message}\nBody: ${rawBody}"
}

// 4. Kiểm tra các field top-level
assert json.success == true : "success must be true but was: ${json.success}"
assert json.message?.toString().contains("Updated") : "message must contain 'Updated' but was: ${json.message}"

// 5. Kiểm tra data không null
assert json.data != null : "data must not be null"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GS_UpdateVariable" id="2c639cdc-8649-4020-96a0-a5417636feb5"><con:settings/><con:config><script>import groovy.json.JsonSlurper

// Lấy step request (Step 1)
def restStep = context.testCase.testSteps["Update infor"]

if (!restStep) {
    log.error "Không tìm thấy step 'Update infor'"
    return
}

// Lấy response
def resp = restStep.testRequest.response
if (!resp) {
    log.error "Chưa có response từ step 'REST Request'"
    return
}

// Parse JSON response
def rawBody = resp.contentAsString
if (!rawBody) {
    log.error "Response body rỗng"
    return
}

def json
try {
    json = new JsonSlurper().parseText(rawBody)
} catch (e) {
    log.error "Không parse được JSON từ response: ${e.message}"
    return
}

def data = json.data
if (!data) {
    log.error "Response không có field 'data'"
    return
}

// Lấy TestCase
def tc = context.testCase

// Gán USERNAME, EMAIL, FULLNAME, FIREBASEID từ response vào TestCase properties
if (data.username) {
    tc.setPropertyValue("USERNAME", data.username.toString())
    log.info "Set USERNAME = ${data.username}"
}

if (data.email) {
    tc.setPropertyValue("EMAIL", data.email.toString())
    log.info "Set EMAIL = ${data.email}"
}

if (data.fullname) {
    tc.setPropertyValue("FULLNAME", data.fullname.toString())
    log.info "Set FULLNAME = ${data.fullname}"
}

if (data.firebase_id) {
    tc.setPropertyValue("FIREBASE_ID", data.firebase_id.toString())
    log.info "Set FIREBASE_ID = ${data.firebase_id}"
}

// Cập nhật PASSWORD từ TestCase property upd_new_password
def newPass = tc.getPropertyValue("upd_new_password")

if (newPass) {
    tc.setPropertyValue("PASSWORD", newPass)
    log.info "Set PASSWORD từ TestCase property 'upd_new_password'"
} else {
    log.warn "TestCase property 'upd_new_password' đang rỗng – không cập nhật PASSWORD"
}
</script></con:config></con:testStep><con:testStep type="restrequest" name="Get Infor 2" id="43544889-712e-4817-acff-98690d2e9dd9"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/user/me/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Get Infor 2" id="c4d19ada-9e8b-41be-b366-0250363934e4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">&#13;
  &lt;con:entry key="Authorization" value="Bearer ${#TestCase#access_token}"/>&#13;
  &lt;con:entry key="Content-Type" value="application/json"/>&#13;
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request/><con:originalUri>http://localhost/api/user/me/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="c13d0e1a-fe5c-450d-8691-349a741f5f55" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// 1. HTTP status
def status = messageExchange.responseStatusCode as Integer
assert status == 200 : "Expected 200 but got ${status}"

// 2. Parse JSON
def body = messageExchange.response.responseContent
def json = new JsonSlurper().parseText(body)

// 3. Các field cơ bản
assert json.success == true : "success phải true"
assert json.message == "Fetched" : "message phải là 'Fetched' nhưng hiện tại là '${json.message}'"

// 4. Lấy expected từ TestCase (do JDBC step / Groovy set trước đó)
def expectedUsername = context.expand('${#TestCase#username}')
def expectedEmail    = context.expand('${#TestCase#email}')
def expectedFullname = context.expand('${#TestCase#fullname}')

// 5. Check data
assert json.data != null : "data không được null"
assert json.data.id instanceof Integer

assert json.data.username == expectedUsername : "Sai username. Expect=${expectedUsername}, Got=${json.data.username}"
assert json.data.email    == expectedEmail    : "Sai email. Expect=${expectedEmail}, Got=${json.data.email}"
assert json.data.fullname == expectedFullname : "Sai fullname. Expect=${expectedFullname}, Got=${json.data.fullname}"

// (optional) 6. Không lộ field nhạy cảm
def sensitiveFields = ["password", "is_superuser", "last_login", "groups", "user_permissions"]
sensitiveFields.each { f ->
    assert !json.data.containsKey(f) : "Sensitive field '${f}' MUST NOT appear in response"
}
</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="7378ca09-27d7-4989-a98f-4f739ca51867" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

def body = messageExchange.responseContent
def json = new JsonSlurper().parseText(body)
def data = json.data

def tc = context.testCase

def oldUsername = tc.getPropertyValue("old_username")
def oldEmail    = tc.getPropertyValue("old_email")
def oldFullname = tc.getPropertyValue("old_fullname")
def oldFirebase = tc.getPropertyValue("old_firebase")

log.info "Old fullname   = ${oldFullname} | New fullname   = ${data.fullname}"
log.info "Old email      = ${oldEmail}    | New email      = ${data.email}"
log.info "Old firebase   = ${oldFirebase} | New firebase   = ${data.firebase_id}"

// Ví dụ: username giữ nguyên
assert data.username?.toString() == oldUsername : "USERNAME sau update bị đổi, không mong muốn!"

// Các field còn lại PHẢI khác (vì anh vừa update)
assert data.fullname?.toString()   != oldFullname : "FULLNAME không thay đổi sau update!"
assert data.email?.toString()      != oldEmail    : "EMAIL không thay đổi sau update!"
assert data.firebase_id?.toString() != oldFirebase : "FIREBASE_ID không thay đổi sau update!"
</scriptText></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:loadTest id="23ff259b-48e7-4f6c-b185-e00b8da5ef06" name="LoadTest-Simple"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="39c24068-434b-4319-8017-d3bb033a6eaf" name="LoadTest - Variance"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>80</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Variance</con:type><con:config><interval>60000</interval><variance>0.7</variance></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties><con:property><con:name>username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email</con:name><con:value>user_20251210_093947_156925@example.com</con:value></con:property><con:property><con:name>fullname</con:name><con:value>User_20251210_093947</con:value></con:property><con:property><con:name>password</con:name><con:value>Pass833065</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>fb_20251210_093947</con:value></con:property><con:property><con:name>topic_title</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>topic_words</con:name><con:value>花</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1MzM0Njg3LCJpYXQiOjE3NjUzMzQzODcsImp0aSI6ImEyMWVjMTM5OTQ0MTRiYzY4ODJlMjc5ODM1MzEwMTZhIiwidXNlcl9pZCI6IjY5In0.HT6T7LSkupZbo97HmAL__jQUq8i8OIa8QPoWbwA3_Vs</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2NTQyMDc4NywiaWF0IjoxNzY1MzM0Mzg3LCJqdGkiOiI0YmRhNzdmNjdmODc0NjMyOWJiMmI2YzBkYmE5MGRhZSIsInVzZXJfaWQiOiI2OSJ9.DQsaMB6Nr1pkCsRCs2u2mJN3koHtLdr1tsIlaZfIzm4</con:value></con:property><con:property><con:name>user_id</con:name><con:value>69</con:value></con:property><con:property><con:name>username_db</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>email_db</con:name><con:value>user_20251210_093622_ca8886@example.com</con:value></con:property><con:property><con:name>fullname_db</con:name><con:value>User_20251210_093622</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>4694</con:value></con:property><con:property><con:name>add_word</con:name><con:value>花火</con:value></con:property><con:property><con:name>add_word_id</con:name><con:value>16</con:value></con:property><con:property><con:name>vocal_topic_id</con:name><con:value>5519</con:value></con:property><con:property><con:name>vocal_detail_id</con:name><con:value>6438</con:value></con:property><con:property><con:name>search_text</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>old_username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>old_email</con:name><con:value>user_20251210_093622_ca8886@example.com</con:value></con:property><con:property><con:name>old_fullname</con:name><con:value>User_20251210_093622</con:value></con:property><con:property><con:name>old_firebase</con:name><con:value>fb_20251210_093622</con:value></con:property><con:property><con:name>upd_username</con:name><con:value>u_20251209_233104_4b2049</con:value></con:property><con:property><con:name>upd_old_password</con:name><con:value>Pass230927</con:value></con:property><con:property><con:name>upd_new_password</con:name><con:value>Pass833065</con:value></con:property><con:property><con:name>upd_email</con:name><con:value>user_20251210_093947_156925@example.com</con:value></con:property><con:property><con:name>upd_fullname</con:name><con:value>User_20251210_093947</con:value></con:property><con:property><con:name>upd_firebase</con:name><con:value>fb_20251210_093947</con:value></con:property></con:properties></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>base_url</con:name><con:value>http://localhost:8000</con:value></con:property><con:property><con:name>jdbc_conn</con:name><con:value>jdbc:mysql://localhost:3306/smartnote_local_db?user=root&amp;password=hoang123&amp;useSSL=false&amp;serverTimezone=UTC </con:value></con:property><con:property><con:name>jdbc_driver</con:name><con:value>com.mysql.cj.jdbc.Driver</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1MzM0NjA2LCJpYXQiOjE3NjUzMzQzMDYsImp0aSI6ImIzM2ZlNGZmNGI2MjRmYjhiOWI1NmIyY2Y2MTgyOGJiIiwidXNlcl9pZCI6IjcwIn0.UHT_ykLNRQThSmSHcyRlU8wMDAuWBUc3IQjkx8oQ1us</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2NTQyMDcwNiwiaWF0IjoxNzY1MzM0MzA2LCJqdGkiOiJjY2MyMTZiNjIyYTI0NGI4YjVhYWE3ZGJkMGI1OWNjMyIsInVzZXJfaWQiOiI3MCJ9.rLrwMYU1PxIzbc1W_1v78VTWC0aKtnkFrEGhtGwCTJU</con:value></con:property><con:property><con:name>user_id</con:name><con:value>70</con:value></con:property><con:property><con:name>username</con:name><con:value>u_20251209_235551_e06757</con:value></con:property><con:property><con:name>email</con:name><con:value>user_20251210_093826_d924ef@example.com</con:value></con:property><con:property><con:name>fullname</con:name><con:value>User_20251210_093826</con:value></con:property><con:property><con:name>password</con:name><con:value>Pass304507</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>fb_20251210_093826</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>3878</con:value></con:property><con:property><con:name>search_text</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>add_word</con:name><con:value>古い</con:value></con:property><con:property><con:name>vocal_topic_id</con:name><con:value>94</con:value></con:property><con:property><con:name>add_word_id</con:name><con:value>47</con:value></con:property><con:property><con:name>topic_title</con:name><con:value>tv_20251210_004052_9f800b</con:value></con:property><con:property><con:name>vocal_detail_id</con:name><con:value>94</con:value></con:property><con:property><con:name>access</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzY1MjA0MDcyLCJpYXQiOjE3NjUyMDM3NzIsImp0aSI6IjdkMzRlMmUzMDMyYTQ5YmViYTNhMjZkMTk2YTM0Y2VlIiwidXNlcl9pZCI6IjMwIn0.Ay2HfdYni5iefjYeKPh_m30okdo7Y5VXhknRMzWccL8</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer><con:oAuth2Profile><con:name>Profile 1</con:name><con:accessToken/><con:accessTokenPosition>HEADER</con:accessTokenPosition><con:oAuth2Flow>AUTHORIZATION_CODE_GRANT</con:oAuth2Flow><con:refreshAccessTokenMethod>AUTOMATIC</con:refreshAccessTokenMethod><con:accessTokenStatus>UNKNOWN</con:accessTokenStatus><con:accessTokenStartingStatus>ENTERED_MANUALLY</con:accessTokenStartingStatus></con:oAuth2Profile></con:oAuth2ProfileContainer><con:oAuth1ProfileContainer><con:oAuth1Profile><con:name>Profile 2</con:name><con:accessTokenPosition>HEADER</con:accessTokenPosition></con:oAuth1Profile></con:oAuth1ProfileContainer><con:sensitiveInformation/></con:soapui-project>