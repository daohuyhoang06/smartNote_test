<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="e2a77267-631a-489c-b34b-559c5a955bb3" activeEnvironment="Default" name="smartNote" resourceRoot="" soapui-version="5.9.1" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="ac1a076a-c45a-4d44-94ac-7fcad6afc092" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://localhost:8000" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://localhost:8000</con:endpoint></con:endpoints><con:resource name="Token" path="/api/token/" id="f60b27b3-12fb-45e0-b45c-8366ef9e19ec"><con:settings/><con:parameters/><con:method name="Token 1" id="23c9e88c-aa95-4f38-8ff4-37b84373c99e" method="POST"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>405 400 401</con:status><con:params/></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:request name="Request 1" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="user_create" path="/api/users/" id="0877eeb7-b30d-4124-a787-6aafcb1e332b"><con:settings/><con:parameters/><con:method name="Method 1" id="7d4d7abf-2d37-4f66-973f-7c052805527f" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json</con:mediaType><con:status>400</con:status><con:params/><con:element xmlns:user="http://localhost/api/users/">user:Fault</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json</con:mediaType><con:status>201</con:status><con:params/><con:element xmlns:user="http://localhost/api/users/">user:Response</con:element></con:representation><con:request name="Request 1" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:request></con:method></con:resource></con:interface><con:testSuite id="10a2a491-b0b5-437a-8fc0-c50ef33d3354" name="Auth TestSuite"><con:description>TestSuite generated for REST Service [http://localhost:8000]</con:description><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="08c9edef-0664-4753-99e2-3ad6d7ae3552" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="token_create TestCase" searchProperties="true"><con:description>TestCase generated for REST Resource [Token] located at [/api/token/]</con:description><con:settings/><con:testStep type="restrequest" name="Post_token_success" id="c30d20e3-970b-4fdc-9633-031d076b50cb"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Post_token_success" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

def response = messageExchange.responseContent
assert response : "Response rỗng hoặc không nhận được response!"

def json = new JsonSlurper().parseText(response)

// --- Kiểm tra field tồn tại ---
assert json.access != null : "Thiếu access token trong response!"
assert json.refresh != null : "Thiếu refresh token trong response!"

// --- Kiểm tra token không rỗng ---
assert json.access.toString().trim().length() > 0 : "Access token rỗng!"
assert json.refresh.toString().trim().length() > 0 : "Refresh token rỗng!"

// --- Kiểm tra token có độ dài hợp lý (thường JWT ≥ 30 ký tự) ---
assert json.access.size() >= 30 : "Access token quá ngắn – có thể sai format!"
assert json.refresh.size() >= 30 : "Refresh token quá ngắn – có thể sai format!"

log.info " Token hợp lệ – Access &amp; Refresh OK!"
</scriptText></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="83ebc32b-6eeb-4454-9214-23f5f94cb913" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple NotContains" id="81e54bf1-9dbf-493f-9f8e-fc88c944f9e1" name="Not Contains"><con:configuration><token>$.errors</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Transfer_token" id="d22a3dd4-d433-4560-9638-9096ff47e8e3"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfer 1 (access)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Post_token_success</con:sourceStep><con:sourcePath>$.access</con:sourcePath><con:targetType>access_token</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>Transfer 2 (refresh)</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Post_token_success</con:sourceStep><con:sourcePath>$.refresh</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>#Project#</con:targetStep><con:type>JSONPATH</con:type><con:targetTransferType>JSONPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_wrong_username/password" id="f628c3c5-656e-4ddb-bf0d-72e617664e51"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_wrong_username/password" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "h", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="0e1fc331-9480-4498-ae4a-33c7004fda0e" name="Valid HTTP Status Codes"><con:configuration><codes>401</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="5f77ceff-d60b-41fe-8762-b7777616a315" name="JsonPath Match"><con:configuration><path>$.success</path><content>false</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Simple Contains" id="5a8425b1-7920-40d6-9c62-90296a7da352" name="Contains"><con:configuration><token>No active account found with the given credentials</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="3553b815-bf08-4e7c-9942-91458d4d5fca"><con:configuration/></con:assertion><con:assertion type="JsonPath Match" id="49d639b0-9d0f-45c1-9fd7-34f9d5ad8640" name="JsonPath Match 1"><con:configuration><path>$.data</path><content>{}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_empty_username" id="ab9b9319-b78d-4f27-b2f8-1685f72349ec"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_empty_username" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="56967687-0da5-4d34-a52c-97327c871416" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
def json = new JsonSlurper().parseText(messageExchange.responseContent)

// 1. HTTP status phải là 400
assert messageExchange.responseHeaders["#status#"][0].contains("400")

// 2. Phải có field errors.username
assert json.errors
assert json.errors.username

// 3. errors.username phải là List
assert json.errors.username instanceof List

// 4. Thông báo lỗi phải liên quan đến "blank" hoặc "required"
def msg = json.errors.username[0].toLowerCase()
assert msg.contains("blank") || msg.contains("required")

// 5. Không được trả access/refresh
assert !json.access
assert !json.refresh
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_empty_password" id="481e0884-549a-4855-830c-2aa48771a127"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_empty_password" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}", "password": "" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="1ce86624-41c6-4d08-aa45-afb94ed164f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
def json = new JsonSlurper().parseText(messageExchange.responseContent)

assert messageExchange.responseHeaders["#status#"][0].contains("400")

assert json.errors
assert json.errors.password
assert json.errors.password instanceof List

def msg = json.errors.password[0].toLowerCase()
assert msg.contains("blank") || msg.contains("required")

assert !json.access
assert !json.refresh
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_missing_username" id="2782a19d-f52c-4a1a-9242-b03ef5300c41"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_missing_username" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{"password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="49017725-9fb7-4b2d-8791-c09935aec312" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy response
def response = messageExchange.responseContent
assert response : "Response rỗng – API không trả về dữ liệu!"

// Parse JSON
def json = new JsonSlurper().parseText(response)

// --- 1. Kiểm tra HTTP status (tuỳ backend, thường 400 Bad Request) ---
assert messageExchange.responseHeaders["#status#"][0].contains("400") : "HTTP status không phải 400 – Response: ${messageExchange.responseContent}"

// --- 2. Kiểm tra success phải là false ---
assert json.success == false : "Success không phải false"

// --- 3. Kiểm tra có field errors ---
assert json.errors : "Không có field 'errors' trong response"

// --- 4. Kiểm tra username tồn tại trong errors ---
assert json.errors.username : "Field 'username' không tồn tại trong errors"

// --- 5. username phải là List ---
assert json.errors.username instanceof List : "Field 'username' không phải dạng List"

// --- 6. Kiểm tra thông báo lỗi có liên quan đến 'required' hoặc 'blank' ---
def usernameErrorMsg = json.errors.username[0].toLowerCase()
assert usernameErrorMsg.contains("required") || usernameErrorMsg.contains("blank") : "Message lỗi không hợp lệ: ${usernameErrorMsg}"

log.info "Validation error username – Assertion passed!"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_missing_password" id="20f53833-68eb-4fcc-9371-5a5e665f7729"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_missing_password" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "${#Project#username}"}</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="fbcccac0-5993-4bb7-956f-97ba86d002d9" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy response
def response = messageExchange.responseContent
assert response : "Response rỗng – API không trả về dữ liệu!"

// Parse JSON
def json = new JsonSlurper().parseText(response)

// --- 1. Kiểm tra HTTP status (tuỳ backend, thường 400 Bad Request) ---
assert messageExchange.responseHeaders["#status#"][0].contains("400") : "HTTP status không phải 400 – Response: ${messageExchange.responseContent}"

// --- 2. Kiểm tra success phải là false ---
assert json.success == false : "Success không phải false"

// --- 3. Kiểm tra có field errors ---
assert json.errors : "Không có field 'errors' trong response"

// --- 4. Kiểm tra username tồn tại trong errors ---
assert json.errors.password : "Field 'password' không tồn tại trong errors"

// --- 5. username phải là List ---
assert json.errors.password instanceof List : "Field 'password' không phải dạng List"

// --- 6. Kiểm tra thông báo lỗi có liên quan đến 'required' hoặc 'blank' ---
def passwordErrorMsg = json.errors.password[0].toLowerCase()
assert passwordErrorMsg.contains("required") || passwordErrorMsg.contains("blank") : "Message lỗi không hợp lệ: ${passwordErrorMsg}"

log.info "Validation error password – Assertion passed!"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="JDBC Request" id="eecf713e-f14d-45b9-b19e-cd9ff831e0fd"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT COUNT(*) AS CNT
FROM users_user
WHERE username = ''' OR ''1''=''1';</con:query><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="POST_token_sql_injection" id="5b328b84-9868-4e42-acae-78eede56a5ed"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/token/" methodName="Token 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_token_sql_injection" id="4d7d7387-4905-4b63-940c-e2643451e8b4" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000/</con:endpoint><con:request>{ "username": "' OR '1'='1", "password": "${#Project#password}" }</con:request><con:originalUri>http://localhost//api/token/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="407076fe-de7f-4af2-8804-52544c11fefa" name="Script Assertion"><con:configuration><scriptText>// Script Assertion: kiểm tra HTTP status + không lộ lỗi SQL/debug

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer

// Cho phép các mã lỗi khi SQLi (sai TK/MK, request không hợp lệ...)
def allowedCodes = [400, 401]

assert allowedCodes.contains(status) : 
        "HTTP status không hợp lệ cho test SQLi, expected one of ${allowedCodes}, got ${status}"

// ===== 2. Kiểm tra KHÔNG lộ lỗi SQL / debug info =====
def body  = messageExchange.responseContent ?: ""
def lower = body.toLowerCase()

// Các chuỗi NHẠY CẢM không được xuất hiện trong response
def forbidden = [
    "syntax error",
    "sql",
    "mysql",
    "ora-",
    "exception",
    "stack trace"
]

// Tìm xem có chuỗi cấm nào xuất hiện không
def hits = forbidden.findAll { f -> lower.contains(f.toLowerCase()) }

assert hits.isEmpty() : 
        "Response chứa thông tin lỗi/SQL nhạy cảm: ${hits.join(', ')}"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:loadTest id="5d767908-0607-470e-a4e6-a6259db80e20" name="LoadTest 1"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>5</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:assertion type="Step Maximum" name="Step Maximum"><con:configuration><name>Step Maximum</name><min-requests>100</min-requests><max-value>1000</max-value><test-step>- Any -</test-step><max-errors>3</max-errors></con:configuration></con:assertion><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="20c18618-fad6-41d9-9d48-c88c40e79e70" name="LoadTest 2"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>100</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>30</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>0</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="98a9049e-24d5-4b9c-a3e2-18a30a3536d5" name="LoadTest 3"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>15</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>60</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:assertion type="Step Maximum" name="Step Maximum"><con:configuration><name>Step Maximum</name><min-requests>100</min-requests><max-value>1200</max-value><test-step>- Any -</test-step><max-errors>3</max-errors></con:configuration></con:assertion><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:loadTest id="8e081318-4086-4bef-b030-f8bd7aa642b3" name="LoadTest 4"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>50</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>30</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Burst</con:type><con:config><burstDelay>0</burstDelay><burstDuration>10000</burstDuration></con:config></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval></con:loadTest><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="53ab2424-1a59-46e4-9e97-338ff6b2e4fe" name="User TestSuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="831abc80-7c25-472e-8984-d0808c0b6497" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="user_create TestCase" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="TC_USER_01_CreateUser_Success_Normal" id="5464cf2f-6f43-43bc-a2d0-13e1556d2170"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_user_create_success" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang066",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoangg",
      "password": "hoang123",
      "firebase_id": "666666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="81a9852d-65c1-438f-a396-51d57c65f947" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
import java.time.OffsetDateTime

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer
assert status == 201 || status == 200 : "Expected HTTP 201/200 nhưng nhận được ${status}"

// ===== 2. Parse JSON =====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ===== 3. Check các field top-level =====
assert json.success == true : "Trường success phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "message phải = 'Created', hiện tại = '${json.message}'"
assert json.data != null : "Trường data bị null!"

def data = json.data

// ===== 4. Kiểm tra các field trong data =====

// id > 0
assert (data.id instanceof Number) &amp;&amp; data.id > 0 : "id phải là số dương, hiện tại = ${data.id}"

// các field string không được rỗng
assert data.username : "username trống hoặc null!"
assert data.email    : "email trống hoặc null!"
assert data.fullname : "fullname trống hoặc null!"
assert data.firebase_id : "firebase_id trống hoặc null!"
assert data.created_at  : "created_at trống hoặc null!"

// ===== 5. Không được có field password ở root hoặc trong data =====
assert !json.containsKey('password') : "Response root không được chứa field 'password'!"

if (json.data instanceof Map) {
    assert !json.data.containsKey('password') : "Response.data không được chứa field 'password'!"
}

// ===== 6. Validate format thời gian created_at (ISO-8601) =====
try {
    OffsetDateTime.parse(data.created_at as String)
} catch (Exception e) {
    assert false : "created_at không phải định dạng ISO-8601 hợp lệ: ${data.created_at}"
}</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_02_CreateUser_Success_UnicodeName" id="dab12b6b-3403-40bc-8fb8-bc0659b7da26"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="POST_user_create_success2" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json; charset=UTF-8" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "huy_dep_traiii",
      "email": "230206657@vnu.edu.vn",
      "fullname": "Đào Quang Huy",
      "password": "huy123####",
      "firebase_id": "88888888888888"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="81a9852d-65c1-438f-a396-51d57c65f947" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper
import java.time.OffsetDateTime

// ===== 1. Kiểm tra HTTP Status =====
def status = messageExchange.responseStatusCode as Integer
assert status == 201 : "Expected HTTP 201nhưng nhận được ${status}"

// ===== 2. Parse JSON =====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ===== 3. Check các field top-level =====
assert json.success == true : "Trường success phải = true, hiện tại = ${json.success}"
assert json.message == "Created" : "message phải = 'Created', hiện tại = '${json.message}'"
assert json.data != null : "Trường data bị null!"

def data = json.data

// ===== 4. Kiểm tra các field trong data =====

// id > 0
assert (data.id instanceof Number) &amp;&amp; data.id > 0 : "id phải là số dương, hiện tại = ${data.id}"

// các field string không được rỗng
assert data.username : "username trống hoặc null!"
assert data.email    : "email trống hoặc null!"
assert data.fullname : "fullname trống hoặc null!"
assert data.firebase_id : "firebase_id trống hoặc null!"
assert data.created_at  : "created_at trống hoặc null!"

// ===== 5. Không được có field password ở root hoặc trong data =====
assert !json.containsKey('password') : "Response root không được chứa field 'password'!"

if (json.data instanceof Map) {
    assert !json.data.containsKey('password') : "Response.data không được chứa field 'password'!"
}

// ===== 6. Validate format thời gian created_at (ISO-8601) =====
try {
    OffsetDateTime.parse(data.created_at as String)
} catch (Exception e) {
    assert false : "created_at không phải định dạng ISO-8601 hợp lệ: ${data.created_at}"
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="59a5d889-0f4f-4910-a749-8ee1924858e8" name="Script Assertion 1"><con:configuration><scriptText>import groovy.json.JsonSlurper

// Lấy raw response
def raw = messageExchange.responseContent
assert raw : "Response rỗng, không có gì để gán biến!"

// Parse JSON
def json = new JsonSlurper().parseText(raw)

// Đảm bảo tạo thành công
assert json.success == true : "Create user thất bại, không gán biến đâu!"
assert json.data != null : "Trường data null, không gán biến được!"

def data = json.data

// 1) Gán vào TestCase Properties (dùng trong cùng TestCase)
def tc = context.testCase
tc.setPropertyValue("user_id",      (data.id ?: "").toString())
tc.setPropertyValue("username",     (data.username ?: "").toString())
tc.setPropertyValue("email",        (data.email ?: "").toString())
tc.setPropertyValue("fullname",     (data.fullname ?: "").toString())
tc.setPropertyValue("firebase_id",  (data.firebase_id ?: "").toString())
tc.setPropertyValue("created_at",   (data.created_at ?: "").toString())

// 2) (Tùy chọn) Gán thêm vào Project Properties để các TestCase khác dùng chung
def project = tc.testSuite.project
project.setPropertyValue("current_user_id",     (data.id ?: "").toString())
project.setPropertyValue("current_username",    (data.username ?: "").toString())
project.setPropertyValue("current_email",       (data.email ?: "").toString())
project.setPropertyValue("current_fullname",    (data.fullname ?: "").toString())
project.setPropertyValue("current_firebase_id", (data.firebase_id ?: "").toString())
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="TC_USER_DBVerify_UserCreatedCorrectly" id="0e3bdadc-b7f7-4afb-bb14-63962c771bb4"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:driver>${#Project#jdbc_driver}</con:driver><con:connectionString>${#Project#jdbc_conn}</con:connectionString><con:query>SELECT username, email, fullname, firebase_id
FROM users_user
WHERE username = '${#TestCase#username}';
</con:query><con:assertion type="GroovyScriptAssertion" id="07b84d2a-7202-454c-8d5a-fbe8f358cf20" name="Script Assertion"><con:configuration><scriptText>// JDBC assertion: kiểm tra user vừa tạo có đúng trong DB

def xmlText = messageExchange.responseContent
assert xmlText : "JDBC response rỗng – kiểm tra lại query!"

def xml = new XmlSlurper().parseText(xmlText)

// Lấy tất cả Row
def rows = xml.ResultSet.Row
def expectedUsername = context.expand('${#TestCase#username}')
def expectedEmail    = context.expand('${#TestCase#email}')
def expectedFullname = context.expand('${#TestCase#fullname}')
def expectedFirebase = context.expand('${#TestCase#firebase_id}')

// 1. Phải có đúng 1 bản ghi
assert rows.size() == 1 : "Expected 1 user with username=${expectedUsername}, nhưng tìm thấy ${rows.size()} bản ghi."

def row = rows[0]

def dbUsername = row.'USERS_USER.USERNAME'.text()
def dbEmail    = row.'USERS_USER.EMAIL'.text()
def dbFullname = row.'USERS_USER.FULLNAME'.text()
def dbFirebase = row.'USERS_USER.FIREBASE_ID'.text()

// 2. So sánh từng field
assert dbUsername == expectedUsername : "USERNAME trong DB (${dbUsername}) khác expected (${expectedUsername})"
assert dbEmail    == expectedEmail    : "EMAIL trong DB (${dbEmail}) khác expected (${expectedEmail})"
assert dbFullname == expectedFullname : "FULLNAME trong DB (${dbFullname}) khác expected (${expectedFullname})"
assert dbFirebase == expectedFirebase : "FIREBASE_ID trong DB (${dbFirebase}) khác expected (${expectedFirebase})"
</scriptText></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_03_CreateUser_MissingUsername" id="f2265258-9c75-438e-92c6-fdb470359410"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="TC_USER_03_CreateUser_MissingUsername" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "email": "hoang25004666@gmail.com",
      "fullname": "dao huy hoangggg",
      "password": "hoang123",
      "firebase_id": "6666666666666zz"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="2ad4dc67-579c-4f65-a0ff-d1671c6c47ca" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 :
        "Expected HTTP 400 cho case thiếu username, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case thiếu username thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "This field is required." :
        "Thông báo lỗi username sai. Expected 'This field is required.', got '${firstMsg}'"


</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_04_CreateUser_EmptyUsername" id="d0501abd-f40b-4a18-b490-b68c6842ef95"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="TC_USER_04_CreateUser_EmptyUsername" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "",
      "email": "hoang2500468@gmail.com",
      "fullname": "dao huy hoangzz",
      "password": "hoang123",
      "firebase_id": "6666666666666xx"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7b01f11f-4399-4178-ae3b-932ab9c0a13b" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case username rỗng, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case username rỗng thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "This field may not be blank." :
        "Thông báo lỗi username sai. Expected 'This field may not be blank.', got '${firstMsg}'"


</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_05_CreateUser_InvalidCharUsername" id="e7be0a62-2bed-4529-9b59-2c5a228b9185"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="TC_USER_05_CreateUser_InvalidCharUsername" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "đào_hoàng",
      "email": "hoang2500461@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "1901010"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="f614f52d-44ec-4d5f-9b8b-d2f4c96809ea" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case username sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case username sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field username ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List &amp;&amp; json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def firstMsg = json.errors.username[0] as String
assert firstMsg == "Username ≥4 ký tự, chỉ gồm chữ/số/_."
        : "Thông báo lỗi username sai. Expected 'Username ≥4 ký tự, chỉ gồm chữ/số/_.', got '${firstMsg}'"

// ==== 5. Không lộ password trong response (phòng hờ) ====
assert !json.containsKey('password') : "Root response không được có field 'password'"
if (json.data instanceof Map) {
    assert !json.data.containsKey('password') :
            "data không được có field 'password'"
}
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_06_CreateUser_InvalidEmailFormat" id="9f1be45a-2843-4c4e-884b-1f6a044eef02"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="TC_USER_06_CreateUser_InvalidEmailFormat" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "hoang_dep_traizzz",
      "email": "23020666",
      "fullname": "Đào Huy Hoàng",
      "password": "hoang123####",
      "firebase_id": "666666666666666sssiizz"
}</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="7fbf16bb-7db4-4d99-8db8-ff5231d19e2f" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case email sai format, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case email sai format thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map &amp;&amp; json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho field email ====
assert json.errors != null : "Trường errors không được null"
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List &amp;&amp; json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def firstMsg = json.errors.email[0] as String
assert firstMsg == "Enter a valid email address." :
        "Thông báo lỗi email sai. Expected 'Enter a valid email address.', got '${firstMsg}'"
</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="TC_USER_07_CreateUser_DuplicateInfo" id="f4d9d5ca-db43-434b-aaf7-93d4fdf065c1"><con:settings/><con:config service="http://localhost:8000" resourcePath="/api/users/" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="TC_USER_07_CreateUser_DuplicateInfo" id="6c778627-aba2-4b39-842e-70237249749e" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8000</con:endpoint><con:request>{
      "username": "dhhoang06",
      "email": "hoang250046@gmail.com",
      "fullname": "dao huy hoang",
      "password": "hoang123",
      "firebase_id": "6666666666666"
   }</con:request><con:originalUri>http://localhost/api/users/</con:originalUri><con:assertion type="GroovyScriptAssertion" id="5f5366ba-34f9-48fa-8aa0-55053b65ed98" name="Script Assertion"><con:configuration><scriptText><![CDATA[import groovy.json.JsonSlurper

// ==== 1. Kiểm tra HTTP status ====
def status = messageExchange.responseStatusCode as Integer
assert status == 400 || status == 422 :
        "Expected HTTP 400/422 cho case trùng thông tin, nhưng nhận ${status}"

// ==== 2. Parse JSON response ====
def raw = messageExchange.responseContent
assert raw : "Response rỗng!"

def json = new JsonSlurper().parseText(raw)

// ==== 3. Kiểm tra các field chính ====
assert json.success == false :
        "Case trùng thông tin thì success phải = false, hiện = ${json.success}"

assert json.message == "Validation error" :
        "message phải = 'Validation error', hiện = '${json.message}'"

// data phải là object rỗng
assert json.data instanceof Map && json.data.isEmpty() :
        "data phải là {} rỗng, hiện = ${json.data}"

// ==== 4. Kiểm tra lỗi cho từng field ====

// ----- username -----
assert json.errors != null : "Trường errors không được null"
assert json.errors.username != null :
        "errors phải có key 'username'"
assert json.errors.username instanceof List && json.errors.username.size() > 0 :
        "errors.username phải là list chứa ít nhất 1 message, hiện = ${json.errors.username}"

def usernameMsg = json.errors.username[0] as String
assert usernameMsg == "This field must be unique." :
        "Thông báo lỗi username sai. Expected 'This field must be unique.', got '${usernameMsg}'"

// ----- email -----
assert json.errors.email != null :
        "errors phải có key 'email'"
assert json.errors.email instanceof List && json.errors.email.size() > 0 :
        "errors.email phải là list chứa ít nhất 1 message, hiện = ${json.errors.email}"

def emailMsg = json.errors.email[0] as String
assert emailMsg == "This field must be unique." :
        "Thông báo lỗi email sai. Expected 'This field must be unique.', got '${emailMsg}'"

// ----- firebase_id -----
assert json.errors.firebase_id != null :
        "errors phải có key 'firebase_id'"
assert json.errors.firebase_id instanceof List && json.errors.firebase_id.size() > 0 :
        "errors.firebase_id phải là list chứa ít nhất 1 message, hiện = ${json.errors.firebase_id}"

def firebaseMsg = json.errors.firebase_id[0] as String
assert firebaseMsg == "user with this firebase id already exists." :
        "Thông báo lỗi firebase_id sai. Expected 'user with this firebase id already exists.', got '${firebaseMsg}'"

]]></scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>username</con:name><con:value>huy_dep_traiii</con:value></con:property><con:property><con:name>email</con:name><con:value>230206657@vnu.edu.vn</con:value></con:property><con:property><con:name>fullname</con:name><con:value>Đào Quang Huy</con:value></con:property><con:property><con:name>firebase_id</con:name><con:value>88888888888888</con:value></con:property><con:property><con:name>user_id</con:name><con:value>16</con:value></con:property><con:property><con:name>created_at</con:name><con:value>2025-11-22T22:39:31.619566+07:00</con:value></con:property></con:properties></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>base_url</con:name><con:value>http://localhost:8000</con:value></con:property><con:property><con:name>username</con:name><con:value>2hoanglinh11</con:value></con:property><con:property><con:name>password</con:name><con:value>2hoanglinh</con:value></con:property><con:property><con:name>access_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYzODAzMDc2LCJpYXQiOjE3NjM4MDI3NzYsImp0aSI6IjI3MjgxZDAyMzMwYzRlMWQ4ZTgzNWMyNjBjYmJjZjkxIiwidXNlcl9pZCI6IjExIn0.ZfR1iPRjjvkORi04tu25WHpMwMv3tb9xQhASWPvXygQ</con:value></con:property><con:property><con:name>refresh_token</con:name><con:value>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc2Mzg4OTE3NiwiaWF0IjoxNzYzODAyNzc2LCJqdGkiOiIzYjRjZGFiMmU0Y2E0OGY0ODY2MDY3YzI3ZThjM2ZiZSIsInVzZXJfaWQiOiIxMSJ9.pG4xROLCPd7bEpnMd0xGEg4MFc_WpLOw3ij234NhWb4</con:value></con:property><con:property><con:name>topic_id</con:name><con:value>23</con:value></con:property><con:property><con:name>jdbc_driver</con:name><con:value>com.mysql.cj.jdbc.Driver</con:value></con:property><con:property><con:name>jdbc_conn</con:name><con:value>jdbc:mysql://localhost:3306/smartnote_local_db?user=root&amp;password=hoang123&amp;useSSL=false&amp;serverTimezone=UTC </con:value></con:property><con:property><con:name>current_user_id</con:name><con:value>16</con:value></con:property><con:property><con:name>current_username</con:name><con:value>huy_dep_traiii</con:value></con:property><con:property><con:name>current_email</con:name><con:value>230206657@vnu.edu.vn</con:value></con:property><con:property><con:name>current_fullname</con:name><con:value>Đào Quang Huy</con:value></con:property><con:property><con:name>current_firebase_id</con:name><con:value>88888888888888</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>